!function(t,i){"use strict";var r={};i.support={ieFilter:!1,rgba:Modernizr.rgba,svg:Modernizr.svg},Modernizr.opacity&&(i.support.opacity=Modernizr.prefixed("opacity")),Modernizr.csstransforms&&(i.support.transformFunction=Modernizr.prefixed("transform")),Modernizr.backgroundsize&&(i.support.backgroundsize=Modernizr.prefixed("backgroundSize")),Modernizr.borderradius&&(i.support.borderTopLeftRadius=Modernizr.prefixed("borderTopLeftRadius"),i.support.borderTopRightRadius=Modernizr.prefixed("borderTopRightRadius"),i.support.borderBottomRightRadius=Modernizr.prefixed("borderBottomRightRadius"),i.support.borderBottomLeftRadius=Modernizr.prefixed("borderBottomLeftRadius")),i.nextGradientId=0,t.extend(i.PGradient,{initDOM:function(){var t,r,e,o,s,a,n,d,p,h,g=this.startColor,l=this.endColor,c=i.support;1===g.a?this.solid_color="rgb("+String(g.r)+","+String(g.g)+","+String(g.b)+")":c.rgba?this.solid_color=this.startColorStr:this.solid_color="rgb("+String(g.r)+","+String(g.g)+","+String(g.b)+")",g===l?1===g.a?this.css_options={"background-color":"rgb("+String(g.r)+","+String(g.g)+","+String(g.b)+")"}:c.rgba?this.css_options={"background-color":this.startColorStr}:c.ieFilter?(t="0"+Math.round(255*g.a).toString(16).toUpperCase(),r="0"+g.r.toString(16).toUpperCase(),e="0"+g.g.toString(16).toUpperCase(),o="0"+g.b.toString(16).toUpperCase(),s="#"+t.slice(t.length-2)+r.slice(r.length-2)+e.slice(e.length-2)+o.slice(o.length-2),this.ie_filter='progid:DXImageTransform.Microsoft.Gradient(GradientType=0,startColorstr="'+s+'",endColorstr="'+s+'")'):this.css_options={"background-color":"rgb("+String(g.r)+","+String(g.g)+","+String(g.b)+")"}:c.svg?(s="rgb("+String(g.r)+","+String(g.g)+","+String(g.b)+")",a="rgb("+String(l.r)+","+String(l.g)+","+String(l.b)+")",this.type===i.GRADIENT_HORIZONTAL?(d=100,p=0):(d=0,p=100),h='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><defs><linearGradient id="friGameGradient'+String(i.nextGradientId)+'" gradientUnits="userSpaceOnUse" x1="0%" y1="0%" x2="'+String(d)+'%" y2="'+String(p)+'%"><stop offset="0%" stop-color="'+s+'" stop-opacity="'+String(g.a)+'" /><stop offset="100%" stop-color="'+a+'" stop-opacity="'+String(l.a)+'" /></linearGradient></defs><rect x="0" y="0" width="1" height="1" fill="url(#friGameGradient'+String(i.nextGradientId)+')" /></svg>',i.nextGradientId+=1,this.css_options={"background-image":'url("data:image/svg+xml;base64,'+btoa(h)+'")'},c.backgroundsize&&(this.css_options[c.backgroundsize]="100% 100%")):c.ieFilter?(t="0"+Math.round(255*g.a).toString(16).toUpperCase(),r="0"+g.r.toString(16).toUpperCase(),e="0"+g.g.toString(16).toUpperCase(),o="0"+g.b.toString(16).toUpperCase(),s="#"+t.slice(t.length-2)+r.slice(r.length-2)+e.slice(e.length-2)+o.slice(o.length-2),t="0"+Math.round(255*l.a).toString(16).toUpperCase(),r="0"+l.r.toString(16).toUpperCase(),e="0"+l.g.toString(16).toUpperCase(),o="0"+l.b.toString(16).toUpperCase(),a="#"+t.slice(t.length-2)+r.slice(r.length-2)+e.slice(e.length-2)+o.slice(o.length-2),n=this.type===i.GRADIENT_HORIZONTAL?1:0,this.ie_filter="progid:DXImageTransform.Microsoft.Gradient(GradientType="+n+',startColorstr="'+s+'",endColorstr="'+a+'")'):this.css_options={"background-color":this.solid_color},this.dom_initialized=!0},getBackground:function(i,r,e){var o=!1;return this.dom_initialized||this.initDOM(),this.css_options&&t.extend(r,this.css_options),this.ie_filter&&(e.gradient=this.ie_filter,o=!0),o},getSolidColor:function(){return this.dom_initialized||this.initDOM(),this.solid_color}}),t.extend(i.PAnimation,{getBackground:function(t,r,e){var o=i.support,s=!1,a=this.options.frameset[0].imageURL;return t===i.BACKGROUND_STRETCHED?o.backgroundsize?(r["background-image"]='url("'+a+'")',r[o.backgroundsize]="100% 100%"):o.ieFilter?(e.image='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+a+'",sizingMethod="scale")',s=!0):r["background-image"]='url("'+a+'")':r["background-image"]='url("'+a+'")',s}}),t.extend(i.PBaseSprite,{transform:function(t,i,r){var e="";return t&&(e+="rotate("+String(t)+"rad)"),(1!==i||1!==r)&&(e+="scale("+String(i)+","+String(r)+")"),e},ieTransform:function(t,i,r){var e,o,s;t||1!==i||1!==r?(e=Math.cos(t),o=Math.sin(t),s="progid:DXImageTransform.Microsoft.Matrix(M11="+String(e*i)+",M12="+String(-o*r)+",M21="+String(o*i)+",M22="+String(e*r)+',SizingMethod="auto expand",FilterType="nearest neighbor")'):s="",this.ieFilters.matrix=s},ieAlpha:function(t){var i;i=1!==t?"progid:DXImageTransform.Microsoft.Alpha(opacity="+String(Math.round(100*t))+")":"",this.ieFilters.alpha=i},applyIeFilters:function(t,i,r,e){var o,s,a=this.dom,n=this.options,d=this.ieFilters,p=Math.round;a.css("filter",d.matrix+d.alpha+d.gradient+d.image),o=a.width(),s=a.height(),n.posOffsetX=p((o-r)/2),n.posOffsetY=p((s-e)/2),a.css({left:String(t-n.posOffsetX)+"px",top:String(i-n.posOffsetY)+"px"})}}),r.PSprite=i.pick(i.PSprite,["init","remove"]),t.extend(i.PSprite,{init:function(t,i,e){r.PSprite.init.apply(this,arguments),this.old_options={}},remove:function(){this.dom&&this.dom.remove(),r.PSprite.remove.apply(this,arguments)},draw:function(r){var e,o,s,a=Math.round,n=this.options,d=this.old_options,p=this.parent,h=n.currentSpriteSheet,g=n.currentFrame,l=n.animation,c=this.dom,u=this.left,m=this.top,f=this.width,b=this.height,S=this.prevLeft,v=this.prevTop,x=i.frameCounter-1,R=n.multix,T=n.multiy,_=n.angle,y=n.scaleh,M=n.scalev,C=n.alpha,k=n.hidden,w={},L=!1,z=!1,F=i.support,G=F.transformFunction,P=F.ieFilter,B=!1,U=i.last_sprite;(u!==S||m!==v)&&(x!==this.frameCounterLastMove?(this.prevLeft=u,this.prevTop=m,this.frameCounterLastMove=x):(m=a(m*r+v*(1-r)),u=a(u*r+S*(1-r)))),s=i.insidePlayground(u,m,f,b),s&&l&&C&&y&&M&&!n.hidden?(c?U!==d.last_sprite&&(c.detach(),U===p?c.prependTo(i.s[p].dom):c.insertAfter(i.s[U].dom),d.last_sprite=U):(c=t('<div id="'+i.domPrefix+this.name+'"></div>'),c.addClass(i.cssClass),U===p?c.prependTo(i.s[p].dom):c.insertAfter(i.s[U].dom),d.last_sprite=U,this.dom=c,P&&(this.ieFilters={matrix:"",alpha:"",gradient:"",image:""})),i.last_sprite=this.name,s!==d.insidePlayground&&(c.show(),d.insidePlayground=s),k!==d.hidden&&(c.show(),d.hidden=k),u!==d.left&&(w.left=String(u-n.posOffsetX)+"px",L=!0,d.left=u),m!==d.top&&(w.top=String(m-n.posOffsetY)+"px",L=!0,d.top=m),e=this.animation_options.frameset[h],o=e.imageURL,o!==d.imageURL&&(w["background-image"]='url("'+o+'")',L=!0,z=!0,d.imageURL=o),l!==d.animation&&(t.extend(w,{width:String(f)+"px",height:String(b)+"px"}),L=!0,z=!0,P&&(_||1!==y||1!==M)&&(B=!0),d.animation=l),(R!==d.multix||T!==d.multiy)&&(z=!0,d.multix=R,d.multiy=T),(z||h!==d.currentSpriteSheet||g!==d.currentFrame)&&(w["background-position"]=""+String(-(e.offsetx+R+g*e.deltax))+"px "+String(-(e.offsety+T+g*e.deltay))+"px",L=!0,d.currentSpriteSheet=h,d.currentFrame=g),(_!==d.angle||y!==d.scaleh||M!==d.scalev)&&(d.scaleh&&d.scalev||c.show(),G?(w[G]=this.transform(_,y,M),L=!0):P?(this.ieTransform(_,y,M),L=!0,B=!0):t.noop(),d.angle=_,d.scaleh=y,d.scalev=M),C!==d.alpha&&(d.alpha||c.show(),F.opacity?(1!==C?w[F.opacity]=String(C):w[F.opacity]="",L=!0):P?(this.ieAlpha(C),L=!0,B=!0):t.noop(),d.alpha=C),L&&c.css(w),P&&B&&this.applyIeFilters(u,m,f,b)):c&&(i.last_sprite=this.name,s||s===d.insidePlayground||(c.hide(),d.insidePlayground=s),l||l===d.animation||(c.css({"background-image":"","background-position":""}),d.imageURL=null,d.animation=l),k&&k!==d.hidden&&(c.hide(),d.hidden=k),C||C===d.alpha||(c.hide(),d.alpha=C),y||y===d.scaleh||(c.hide(),d.scaleh=y),M||M===d.scalev||(c.hide(),d.scalev=M))}}),r.PSpriteGroup=i.pick(i.PSpriteGroup,["init","remove","draw"]),t.extend(i.PSpriteGroup,{init:function(e,o,s){var a;this.old_options={},s||(a=t('<div id="'+i.domPrefix+e+'"></div>').prependTo(t(o.parentDOM)),a.addClass(i.cssClass),a.css({left:"0px",top:"0px",width:String(o.width)+"px",height:String(o.height)+"px",overflow:"hidden"}),this.old_options.last_sprite=e,this.dom=a,a.get(0).filters?(i.support.ieFilter=!0,this.ieFilters={matrix:"",alpha:"",gradient:"",image:""}):i.support.ieFilter=!1),r.PSpriteGroup.init.apply(this,arguments)},remove:function(){r.PSpriteGroup.remove.apply(this,arguments),this.dom&&this.dom.remove()},draw:function(e){var o=Math.round,s=this.options,a=this.old_options,n=this.parent,d=this.left,p=this.top,h=this.width,g=this.height,l=this.prevLeft,c=this.prevTop,u=i.frameCounter-1,m=s.background,f=s.backgroundType,b=s.hasBorder,S=s.borderTopLeftRadius,v=s.borderTopRightRadius,x=s.borderBottomRightRadius,R=s.borderBottomLeftRadius,T=b&&s.borderWidth||0,_=b&&s.borderColor,y=T!==a.borderWidth,M=s.angle,C=s.scaleh,k=s.scalev,w=s.alpha,L=s.hidden,z=s.crop,F={},G=!1,P=this.dom,B=i.support,U=B.transformFunction,O=B.ieFilter,I=O&&this.ieFilters,A=!1,D=i.last_sprite,X=this.name;n||(D=X,i.last_sprite=D),(d!==l||p!==c)&&(u!==this.frameCounterLastMove?(this.prevLeft=d,this.prevTop=p,this.frameCounterLastMove=u):(p=o(p*e+c*(1-e)),d=o(d*e+l*(1-e)))),(this.layers.length||m||_)&&w&&C&&k&&!s.hidden?(this.dom?D!==a.last_sprite&&(P.detach(),D===n?P.prependTo(i.s[n].dom):P.insertAfter(i.s[D].dom),a.last_sprite=D):(P=t('<div id="'+i.domPrefix+this.name+'"></div>'),P.addClass(i.cssClass),D===n?P.prependTo(i.s[n].dom):P.insertAfter(i.s[D].dom),a.last_sprite=D,this.dom=P,O&&(this.ieFilters={matrix:"",alpha:"",gradient:"",image:""},I=this.ieFilters)),i.last_sprite=this.name,L!==a.hidden&&(P.show(),a.hidden=L),(d!==a.left||y)&&(F.left=String(d-s.posOffsetX-T)+"px",G=!0,a.left=d),(p!==a.top||y)&&(F.top=String(p-s.posOffsetY-T)+"px",G=!0,a.top=p),h!==a.width&&(F.width=String(h)+"px",G=!0,O&&(M||1!==C||1!==k)&&(A=!0),a.width=h),g!==a.height&&(F.height=String(g)+"px",G=!0,O&&(M||1!==C||1!==k)&&(A=!0),a.height=g),(M!==a.angle||C!==a.scaleh||k!==a.scalev)&&(a.scaleh&&a.scalev||P.show(),U?(F[U]=this.transform(M,C,k),G=!0):O?(this.ieTransform(M,C,k),G=!0,A=!0):t.noop(),a.angle=M,a.scaleh=C,a.scalev=k),w!==a.alpha&&(a.alpha||P.show(),B.opacity?(1!==w?F[B.opacity]=String(w):F[B.opacity]="",G=!0):O?(this.ieAlpha(w),G=!0,A=!0):t.noop(),a.alpha=w),(m!==a.background||f!==a.backgroundType)&&(F["background-color"]="",F["background-image"]="",B.backgroundsize&&(F[B.backgroundsize]=""),I&&I.gradient&&(I.gradient="",A=!0),I&&I.image&&(I.image="",A=!0),m&&m.getBackground(f,F,I)&&(A=!0),G=!0,a.background=m,a.backgroundType=f),B.borderTopLeftRadius&&((S!==a.borderTopLeftRadius||y)&&(S?F[B.borderTopLeftRadius]=String(S+T)+"px":F[B.borderTopLeftRadius]="",G=!0,a.borderTopLeftRadius=S),(v!==a.borderTopRightRadius||y)&&(v?F[B.borderTopRightRadius]=String(v+T)+"px":F[B.borderTopRightRadius]="",G=!0,a.borderTopRightRadius=v),(x!==a.borderBottomRightRadius||y)&&(x?F[B.borderBottomRightRadius]=String(x+T)+"px":F[B.borderBottomRightRadius]="",G=!0,a.borderBottomRightRadius=x),(R!==a.borderBottomLeftRadius||y)&&(R?F[B.borderBottomLeftRadius]=String(R+T)+"px":F[B.borderBottomLeftRadius]="",G=!0,a.borderBottomLeftRadius=R)),y&&(T?F["border-width"]=String(T)+"px":F["border-width"]="",G=!0,a.borderWidth=T),_!==a.borderColor&&(_?F["border-color"]=_.getSolidColor():F["border-color"]="",G=!0,a.borderWidth=T),z!==a.crop&&(n&&(z?F.overflow="hidden":F.overflow="visible",G=!0),a.crop=z),G&&P.css(F),O&&A&&this.applyIeFilters(d,p,h,g),r.PSpriteGroup.draw.apply(this,arguments),i.last_sprite=X):P&&(i.last_sprite=this.name,L&&L!==a.hidden&&(P.hide(),a.hidden=L),w||w===a.alpha||(P.hide(),a.alpha=w),C||C===a.scaleh||(P.hide(),a.scaleh=C),k||k===a.scalev||(P.hide(),a.scalev=k))}})}(jQuery,friGame);