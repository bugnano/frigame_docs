(function(i,t){"use strict";var e={};t.support={ieFilter:!1,rgba:Modernizr.rgba,svg:Modernizr.svg},Modernizr.opacity&&(t.support.opacity=Modernizr.prefixed("opacity")),Modernizr.csstransforms&&(t.support.transformFunction=Modernizr.prefixed("transform")),Modernizr.backgroundsize&&(t.support.backgroundsize=Modernizr.prefixed("backgroundSize")),t.nextGradientId=0,i.extend(t.PGradient,{initDOM:function(){var i,e,o,s,r,a,n,p,h,d,l=this.startColor,g=this.endColor,c=t.support;l===g?1===l.a?this.css_options={"background-color":["rgb(",l.r+"",",",l.g+"",",",l.b+"",")"].join("")}:c.rgba?this.css_options={"background-color":this.startColorStr}:c.ieFilter?(i=["0",Math.round(255*l.a).toString(16).toUpperCase()].join(""),e=["0",l.r.toString(16).toUpperCase()].join(""),o=["0",l.g.toString(16).toUpperCase()].join(""),s=["0",l.b.toString(16).toUpperCase()].join(""),r=["#",i.slice(i.length-2),e.slice(e.length-2),o.slice(o.length-2),s.slice(s.length-2)].join(""),this.ie_filter=['progid:DXImageTransform.Microsoft.Gradient(GradientType=0,startColorstr="',r,'",endColorstr="',r,'")'].join("")):this.css_options={"background-color":["rgb(",l.r+"",",",l.g+"",",",l.b+"",")"].join("")}:c.svg?(r=["rgb(",l.r+"",",",l.g+"",",",l.b+"",")"].join(""),a=["rgb(",g.r+"",",",g.g+"",",",g.b+"",")"].join(""),this.type===t.GRADIENT_HORIZONTAL?(p=100,h=0):(p=0,h=100),d=['<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none">',"<defs>",'<linearGradient id="friGameGradient',t.nextGradientId+"",'" gradientUnits="userSpaceOnUse" x1="0%" y1="0%" x2="',p+"",'%" y2="',h+"",'%">','<stop offset="0%" stop-color="',r,'" stop-opacity="',l.a+"",'" />','<stop offset="100%" stop-color="',a,'" stop-opacity="',g.a+"",'" />',"</linearGradient>","</defs>",'<rect x="0" y="0" width="1" height="1" fill="url(#friGameGradient',t.nextGradientId+"",')" />',"</svg>"].join(""),t.nextGradientId+=1,this.css_options={"background-image":['url("data:image/svg+xml;base64,',btoa(d),'")'].join("")},c.backgroundsize&&(this.css_options[c.backgroundsize]="100% 100%")):c.ieFilter?(i=["0",Math.round(255*l.a).toString(16).toUpperCase()].join(""),e=["0",l.r.toString(16).toUpperCase()].join(""),o=["0",l.g.toString(16).toUpperCase()].join(""),s=["0",l.b.toString(16).toUpperCase()].join(""),r=["#",i.slice(i.length-2),e.slice(e.length-2),o.slice(o.length-2),s.slice(s.length-2)].join(""),i=["0",Math.round(255*g.a).toString(16).toUpperCase()].join(""),e=["0",g.r.toString(16).toUpperCase()].join(""),o=["0",g.g.toString(16).toUpperCase()].join(""),s=["0",g.b.toString(16).toUpperCase()].join(""),a=["#",i.slice(i.length-2),e.slice(e.length-2),o.slice(o.length-2),s.slice(s.length-2)].join(""),n=this.type===t.GRADIENT_HORIZONTAL?1:0,this.ie_filter=["progid:DXImageTransform.Microsoft.Gradient(GradientType=",n,',startColorstr="',r,'",endColorstr="',a,'")'].join("")):this.css_options=1===l.a?{"background-color":["rgb(",l.r+"",",",l.g+"",",",l.b+"",")"].join("")}:c.rgba?{"background-color":this.startColorStr}:{"background-color":["rgb(",l.r+"",",",l.g+"",",",l.b+"",")"].join("")},this.dom_initialized=!0},getBackground:function(t,e,o){var s=!1;return this.dom_initialized||this.initDOM(),this.css_options&&i.extend(e,this.css_options),this.ie_filter&&(o.gradient=this.ie_filter,s=!0),s}}),i.extend(t.PAnimation,{getBackground:function(i,e,o){var s=t.support,r=!1;return i===t.BACKGROUND_STRETCHED?s.backgroundsize?(e["background-image"]=['url("',this.options.imageURL,'")'].join(""),e[s.backgroundsize]="100% 100%"):s.ieFilter?(o.image=['progid:DXImageTransform.Microsoft.AlphaImageLoader(src="',this.options.imageURL,'",sizingMethod="scale")'].join(""),r=!0):e["background-image"]=['url("',this.options.imageURL,'")'].join(""):e["background-image"]=['url("',this.options.imageURL,'")'].join(""),r}}),i.extend(t.PBaseSprite,{transform:function(){var i=this.options,t=i.angle,e=i.scaleh,o=i.scalev,s=[];return t&&Array.prototype.push.apply(s,["rotate(",t+"","rad)"]),(1!==e||1!==o)&&Array.prototype.push.apply(s,["scale(",e+"",",",o+"",")"]),s.join("")},ieTransform:function(){var i,t,e,o=this.options,s=o.angle,r=o.scaleh,a=o.scalev;s||1!==r||1!==a?(i=Math.cos(s),t=Math.sin(s),e=["progid:DXImageTransform.Microsoft.Matrix(M11=",i*r+"",",M12=",-t*a+"",",M21=",t*r+"",",M22=",i*a+"",',SizingMethod="auto expand",FilterType="nearest neighbor")'].join("")):e="",this.ieFilters.matrix=e},ieAlpha:function(){var i,t=this.options.alpha;i=1!==t?["progid:DXImageTransform.Microsoft.Alpha(opacity=",Math.round(100*t)+"",")"].join(""):"",this.ieFilters.alpha=i},applyIeFilters:function(){var i,t,e=this.dom,o=this.options,s=this.ieFilters,r=Math.round;e.css("filter",[s.matrix,s.alpha,s.gradient,s.image].join("")),i=e.width(),t=e.height(),o.posOffsetX=r((i-this.width)/2),o.posOffsetY=r((t-this.height)/2),e.css({left:[this.left-o.posOffsetX+"","px"].join(""),top:[this.top-o.posOffsetY+"","px"].join("")})}}),e.PSprite=t.pick(t.PSprite,["init","remove"]),i.extend(t.PSprite,{init:function(){e.PSprite.init.apply(this,arguments),this.old_options={}},remove:function(){this.dom&&this.dom.remove(),e.PSprite.remove.apply(this,arguments)},draw:function(){var e=this.options,o=this.old_options,s=this.parent,r=e.currentFrame,a=e.animation,n=this.animation_options,p=this.insidePlayground,h=this.dom,d=this.left,l=this.top,g=e.multix,c=e.multiy,m=e.angle,u=e.scaleh,f=e.scalev,b=e.alpha,j=e.hidden,v={},x=!1,y=!1,_=t.support,k=_.transformFunction,w=_.ieFilter,M=!1,S=t.last_sprite;p&&a&&b&&u&&f&&!e.hidden?(h?S!==o.last_sprite&&(h.detach(),S===s?h.prependTo(t.s[s].dom):h.insertAfter(t.s[S].dom),o.last_sprite=S):(h=i(['<div id="',t.domPrefix,this.name,'"></div>'].join("")),h.addClass(t.cssClass),S===s?h.prependTo(t.s[s].dom):h.insertAfter(t.s[S].dom),o.last_sprite=S,this.dom=h,w&&(this.ieFilters={matrix:"",alpha:"",gradient:"",image:""})),t.last_sprite=this.name,p!==o.insidePlayground&&(h.show(),o.insidePlayground=p),j!==o.hidden&&(h.show(),o.hidden=j),d!==o.left&&(v.left=[d-e.posOffsetX+"","px"].join(""),x=!0,o.left=d),l!==o.top&&(v.top=[l-e.posOffsetY+"","px"].join(""),x=!0,o.top=l),a!==o.animation&&(i.extend(v,{width:[this.width+"","px"].join(""),height:[this.height+"","px"].join(""),"background-image":['url("',n.imageURL,'")'].join("")}),x=!0,y=!0,w&&(m||1!==u||1!==f)&&(M=!0),o.animation=a),(g!==o.multix||c!==o.multiy)&&(y=!0,o.multix=g,o.multiy=c),(y||r!==o.currentFrame)&&(v["background-position"]=[-(n.offsetx+g+r*n.deltax)+"","px ",-(n.offsety+c+r*n.deltay)+"","px"].join(""),x=!0,o.currentFrame=r),(m!==o.angle||u!==o.scaleh||f!==o.scalev)&&(o.scaleh&&o.scalev||h.show(),k?(v[k]=this.transform(),x=!0):w?(this.ieTransform(),x=!0,M=!0):i.noop(),o.angle=m,o.scaleh=u,o.scalev=f),b!==o.alpha&&(o.alpha||h.show(),_.opacity?(v[_.opacity]=1!==b?b+"":"",x=!0):w?(this.ieAlpha(),x=!0,M=!0):i.noop(),o.alpha=b),x&&h.css(v),w&&M&&this.applyIeFilters()):h&&(t.last_sprite=this.name,p||p===o.insidePlayground||(h.hide(),o.insidePlayground=p),a||a===o.animation||(h.css({"background-image":"","background-position":""}),o.animation=a),j&&j!==o.hidden&&(h.hide(),o.hidden=j),b||b===o.alpha||(h.hide(),o.alpha=b),u||u===o.scaleh||(h.hide(),o.scaleh=u),f||f===o.scalev||(h.hide(),o.scalev=f))}}),e.PSpriteGroup=t.pick(t.PSpriteGroup,["init","remove","draw"]),i.extend(t.PSpriteGroup,{init:function(o,s,r){var a;this.old_options={},r||(a=i(['<div id="',t.domPrefix,o,'"></div>'].join("")).prependTo(s.parentDOM),a.addClass(t.cssClass),a.css({left:"0px",top:"0px",width:[s.width+"","px"].join(""),height:[s.height+"","px"].join(""),overflow:"hidden"}),this.old_options.last_sprite=o,this.dom=a,a.get(0).filters?(t.support.ieFilter=!0,this.ieFilters={matrix:"",alpha:"",gradient:"",image:""}):t.support.ieFilter=!1),e.PSpriteGroup.init.apply(this,arguments)},remove:function(){e.PSpriteGroup.remove.apply(this,arguments),this.dom&&this.dom.remove()},draw:function(){var o=this.options,s=this.old_options,r=this.parent,a=this.left,n=this.top,p=this.width,h=this.height,d=o.background,l=o.backgroundType,g=o.angle,c=o.scaleh,m=o.scalev,u=o.alpha,f=o.hidden,b=o.crop,j={},v=!1,x=this.dom,y=t.support,_=y.transformFunction,k=y.ieFilter,w=k&&this.ieFilters,M=!1,S=t.last_sprite,C=this.name;r||(S=C,t.last_sprite=S),(this.layers.length||d)&&u&&c&&m&&!o.hidden?(this.dom?S!==s.last_sprite&&(x.detach(),S===r?x.prependTo(t.s[r].dom):x.insertAfter(t.s[S].dom),s.last_sprite=S):(x=i(['<div id="',t.domPrefix,this.name,'"></div>'].join("")),x.addClass(t.cssClass),S===r?x.prependTo(t.s[r].dom):x.insertAfter(t.s[S].dom),s.last_sprite=S,this.dom=x,k&&(this.ieFilters={matrix:"",alpha:"",gradient:"",image:""},w=this.ieFilters)),t.last_sprite=this.name,f!==s.hidden&&(x.show(),s.hidden=f),a!==s.left&&(j.left=[a-o.posOffsetX+"","px"].join(""),v=!0,s.left=a),n!==s.top&&(j.top=[n-o.posOffsetY+"","px"].join(""),v=!0,s.top=n),p!==s.width&&(j.width=[p+"","px"].join(""),v=!0,k&&(g||1!==c||1!==m)&&(M=!0),s.width=p),h!==s.height&&(j.height=[h+"","px"].join(""),v=!0,k&&(g||1!==c||1!==m)&&(M=!0),s.height=h),(g!==s.angle||c!==s.scaleh||m!==s.scalev)&&(s.scaleh&&s.scalev||x.show(),_?(j[_]=this.transform(),v=!0):k?(this.ieTransform(),v=!0,M=!0):i.noop(),s.angle=g,s.scaleh=c,s.scalev=m),u!==s.alpha&&(s.alpha||x.show(),y.opacity?(j[y.opacity]=1!==u?u+"":"",v=!0):k?(this.ieAlpha(),v=!0,M=!0):i.noop(),s.alpha=u),(d!==s.background||l!==s.backgroundType)&&(j["background-color"]="",j["background-image"]="",y.backgroundsize&&(j[y.backgroundsize]=""),w&&w.gradient&&(w.gradient="",M=!0),w&&w.image&&(w.image="",M=!0),d&&d.getBackground(l,j,w)&&(M=!0),v=!0,s.background=d,s.backgroundType=l),b!==s.crop&&(r&&(j.overflow=b?"hidden":"visible",v=!0),s.crop=b),v&&x.css(j),k&&M&&this.applyIeFilters(),e.PSpriteGroup.draw.apply(this,arguments),t.last_sprite=C):x&&(t.last_sprite=this.name,f&&f!==s.hidden&&(x.hide(),s.hidden=f),u||u===s.alpha||(x.hide(),s.alpha=u),c||c===s.scaleh||(x.hide(),s.scaleh=c),m||m===s.scalev||(x.hide(),s.scalev=m))}})})(jQuery,friGame);