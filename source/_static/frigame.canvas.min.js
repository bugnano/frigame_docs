!function(t){"use strict";var e={};t.extend(t.PGradient,{initCanvas:function(){var t=this.startColor,e=this.endColor;t===e?this.style=this.startColorStr:(this.gradients={},this.gradient_groups={}),this.canvas_initialized=!0},addGroup:function(e,i){var r,a,o,s=i.width,h=i.height,n=i.name;this.canvas_initialized||this.initCanvas(),a=this.gradients,a&&(this.type===t.GRADIENT_HORIZONTAL?(r=s,h=0):(r=h,s=0),a[r]||(o=e.createLinearGradient(0,0,s,h),o.addColorStop(0,this.startColorStr),o.addColorStop(1,this.endColorStr),a[r]={style:o,groups:{}}),a[r].groups[n]=!0,this.gradient_groups[n]=r)},removeGroup:function(e){var i,r,a,o=e.name;this.canvas_initialized||this.initCanvas(),r=this.gradients,r&&(a=this.gradient_groups,void 0!==a[o]&&(i=a[o],delete a[o],r[i]&&(a=r[i].groups,a[o]&&(delete a[o],t.isEmptyObject(a)&&delete r[i]))))},setFillStyle:function(e,i){var r,a=i.width,o=i.height;this.style?e.fillStyle=this.style:(r=this.type===t.GRADIENT_HORIZONTAL?a:o,e.fillStyle=this.gradients[r].style)},setStrokeStyle:function(e,i){var r,a=i.width,o=i.height;this.style?e.strokeStyle=this.style:(r=this.type===t.GRADIENT_HORIZONTAL?a:o,e.strokeStyle=this.gradients[r].style)},drawBackground:function(t,e){this.setFillStyle(t,e),t.fill()}}),t.extend(t.PAnimation,{drawBackground:function(e,i){var r=this.options.frameset[0].img,a=this.style;i.options.backgroundType===t.BACKGROUND_STRETCHED?t.safeDrawImage(e,r,0,0,r.width,r.height,0,0,i.width,i.height):(a||(a=e.createPattern(r,"repeat"),this.style=a),e.fillStyle=a,e.fill())}}),t.extend(t.PSprite,{draw:function(){var e,i,r=this.options,a=r.animation,o=r.angle,s=r.scaleh,h=r.scalev,n=r.alpha,l=this.width,d=this.height,p=r.currentFrame,g=t.ctx;t.insidePlayground(this)&&a&&n&&s&&h&&!r.hidden&&(g.save(),g.translate(this.centerx,this.centery),o&&g.rotate(o),(1!==s||1!==h)&&g.scale(s,h),e=t.globalAlpha,1!==n&&(t.globalAlpha*=n,g.globalAlpha=t.globalAlpha),i=this.animation_options.frameset[r.currentSpriteSheet],t.safeDrawImage(g,i.img,i.offsetx+r.multix+p*i.deltax,i.offsety+r.multiy+p*i.deltay,l,d,-this.halfWidth,-this.halfHeight,l,d),g.restore(),t.globalAlpha=e)}}),e.PSpriteGroup=t.pick(t.PSpriteGroup,["init","remove","draw"]),t.extend(t.PSpriteGroup,{init:function(i,r,a){var o,s,h,n;this.old_options={},a||(o=r.parentDOM,o.getContext?(this.dom=null,t.ctx=o.getContext("2d"),r.width=o.width||300,r.height=o.height||150):(s=r.width,h=r.height,n=document.createElement("canvas"),n.id=[t.domPrefix,i].join(""),n.width=s,n.height=h,o.insertBefore(n,o.firstChild),n.className=t.cssClass,t.extend(n.style,{left:"0px",top:"0px",width:[String(s),"px"].join(""),height:[String(h),"px"].join(""),overflow:"hidden"}),this.dom=n,t.ctx=n.getContext("2d"))),e.PSpriteGroup.init.apply(this,arguments),this.gradients={}},remove:function(){var t=this.options.background,i=this.old_options.background,r=this.options.borderColor,a=this.old_options.borderColor,o=this.dom;e.PSpriteGroup.remove.apply(this,arguments),i&&i.removeGroup&&i.removeGroup(this),t&&t.removeGroup&&t.removeGroup(this),a&&a.removeGroup&&a.removeGroup(this),r&&r.removeGroup&&r.removeGroup(this),o&&o.parentNode&&o.parentNode.removeChild(o)},draw:function(){var i,r,a,o=this.options,s=this.old_options,h=this.parent,n=this.left,l=this.top,d=this.width,p=this.height,g=t.insidePlayground(this),u=g&&o.background,c=s.background,m=o.borderTopLeftRadius,v=o.borderTopRightRadius,f=o.borderBottomRightRadius,y=o.borderBottomLeftRadius,b=m||v||f||y,G=o.borderWidth,w=G/2,S=g&&G&&o.borderColor,C=s.borderColor,x=u!==c,A=S!==C,P=d!==s.width||p!==s.height,R=o.angle,T=o.scaleh,k=o.scalev,_=o.alpha,I=o.crop,N=t.ctx;h||(N.clearRect(0,0,d,p),t.globalAlpha=1),g&&(x||A||P)&&((x||P)&&(c&&c.removeGroup&&(this.gradients[c.name]-=1,(P||!this.gradients[c.name])&&c.removeGroup(this)),u&&u.addGroup&&(this.gradients[u.name]?this.gradients[u.name]+=1:this.gradients[u.name]=1,u.addGroup(N,this)),s.background=u),(A||P)&&(C&&C.removeGroup&&(this.gradients[C.name]-=1,(P||!this.gradients[C.name])&&C.removeGroup(this)),S&&S.addGroup&&(this.gradients[S.name]?this.gradients[S.name]+=1:this.gradients[S.name]=1,S.addGroup(N,this)),s.borderColor=S),s.width=d,s.height=p),(this.layers.length||u||S)&&_&&T&&k&&!o.hidden&&(R||1!==T||1!==k?(N.save(),a=!0,N.translate(this.centerx,this.centery),R&&N.rotate(R),(1!==T||1!==k)&&N.scale(T,k),N.translate(-this.halfWidth,-this.halfHeight)):n||l?(N.save(),a=!0,N.translate(n,l)):a=!1,i=t.globalAlpha,1!==_?(t.globalAlpha*=_,N.globalAlpha=t.globalAlpha,r=!0):r=!1,(u||I)&&(N.beginPath(),b?t.roundedRect(N,0,0,d,p,m,v,f,y):N.rect(0,0,d,p),N.closePath()),u&&u.drawBackground(N,this),S&&(N.beginPath(),b?t.roundedRect(N,-w,-w,d+G,p+G,m?m+w:0,v?v+w:0,f?f+w:0,y?y+w:0):N.rect(-w,-w,d+G,p+G),N.closePath(),S.setStrokeStyle(N,this),N.lineWidth=G,N.stroke()),I&&(a||(N.save(),a=!0),S&&(N.beginPath(),b?t.roundedRect(N,0,0,d,p,m,v,f,y):N.rect(0,0,d,p),N.closePath()),N.clip()),e.PSpriteGroup.draw.apply(this,arguments),a?N.restore():r&&(N.globalAlpha=i),t.globalAlpha=i)}}),t.safeDrawImage=function(t,e,i,r,a,o,s,h,n,l){e&&t&&(0>i&&(s-=n/a*i,a+=i,i=0),0>r&&(h-=l/o*r,o+=r,r=0),i+a>e.width&&(n=n/a*(e.width-i),a=e.width-i),r+o>e.height&&(l=l/o*(e.height-r),o=e.height-r),o>0&&a>0&&i<e.width&&r<e.height&&t.drawImage(e,i,r,a,o,s,h,n,l))},t.roundedRect=function(t,e,i,r,a,o,s,h,n){var l=Math.PI,d=l/2,p=e+r,g=i+a,u=e+o,c=p-s,m=g-h,v=e+n,f=i+o;t.moveTo(u,i),t.lineTo(c,i),s&&t.arc(c,i+s,s,-d,0,!1),t.lineTo(p,m),h&&t.arc(p-h,m,h,0,d,!1),t.lineTo(v,g),n&&t.arc(v,g-n,n,d,l,!1),t.lineTo(e,f),o&&t.arc(u,f,o,l,-d,!1)}}(friGame);