!function(t){"use strict";var e={};t.extend(t.PGradient,{initCanvas:function(){this.startColor===this.endColor?this.style=this.startColorStr:(this.gradients={},this.gradient_groups={}),this.canvas_initialized=!0},addGroup:function(e,i){var a,s,o,r=i.width,h=i.height,n=i.name;this.canvas_initialized||this.initCanvas(),(s=this.gradients)&&(this.type===t.GRADIENT_HORIZONTAL?(a=r,h=0):(a=h,r=0),s[a]||((o=t.ctx.createLinearGradient(0,0,r,h)).addColorStop(0,this.startColorStr),o.addColorStop(1,this.endColorStr),s[a]={style:o,groups:{}}),s[a].groups[n]=!0,this.gradient_groups[n]=a)},removeGroup:function(e){var i,a,s,o=e.name;this.canvas_initialized||this.initCanvas(),(a=this.gradients)&&void 0!==(s=this.gradient_groups)[o]&&(i=s[o],s[o]=null,delete s[o],a[i]&&(s=a[i].groups)[o]&&(s[o]=null,delete s[o],t.isEmptyObject(s)&&(a[i]=null,delete a[i])))},setFillStyle:function(e,i){var a,s=i.width,o=i.height;this.style?e.fillStyle=this.style:(a=this.type===t.GRADIENT_HORIZONTAL?s:o,e.fillStyle=this.gradients[a].style)},setStrokeStyle:function(e,i){var a,s=i.width,o=i.height;this.style?e.strokeStyle=this.style:(a=this.type===t.GRADIENT_HORIZONTAL?s:o,e.strokeStyle=this.gradients[a].style)},drawBackground:function(t,e){this.setFillStyle(t,e),t.fill()}}),t.extend(t.PAnimation,{createCanvas:function(t,e){var i;(i=document.createElement("canvas")).width=t,i.height=e,this.canvas=i,this.canvas_width=t,this.canvas_height=e,this.ctx=i.getContext("2d")},drawBackground:function(e,i){var a=this.options.frameset[0].img,s=this.style;i.options.backgroundType===t.BACKGROUND_STRETCHED?t.safeDrawImage(e,a,0,0,a.width,a.height,0,0,i.width,i.height):(s||(s=t.ctx.createPattern(a,"repeat"),this.style=s),e.fillStyle=s,e.fill())},drawMask:function(e,i){var a=i.options,s=a.maskType,o=a.backgroundType,r=a.background,h=r.name,n=this.options.frameset[0].img,l=this.style,d=i.width,p=i.height,g=this.canvas,c=this.canvas_width,u=this.canvas_height,m=this.ctx;g||(this.createCanvas(d,p),g=this.canvas,c=this.canvas_width,u=this.canvas_height,m=this.ctx),d===this.last_width&&p===this.last_height&&s===this.last_mask_type&&o===this.last_background_type&&h===this.last_background||(c<d&&(g.width=d,c=d,this.canvas_width=d),u<p&&(g.height=p,u=p,this.canvas_height=p),m.globalCompositeOperation="copy",m.rect(0,0,d,p),s===t.MASK_STRETCHED?t.safeDrawImage(m,n,0,0,n.width,n.height,0,0,d,p):(l||(l=t.ctx.createPattern(n,"repeat"),this.style=l),m.fillStyle=l,m.fill()),m.globalCompositeOperation="source-in",r.drawBackground(m,i),this.last_width=d,this.last_height=p,this.last_mask_type=s,this.last_background_type=o,this.last_background=h),t.safeDrawImage(e,g,0,0,d,p,0,0,d,p)}}),t.extend(t.PSprite,{draw:function(e){var i,a,s,o,r,h,n=Math.round,l=this.options,d=l.animation,p=l.transformOriginx,g=l.transformOriginy,c=l.angle,u=l.scaleh,m=l.scalev,v=l.alpha,f=this.left,y=this.top,b=this.width,w=this.height,C=this.prevLeft,_=this.prevTop,x=l.currentFrame,G=t.ctx;f===C&&y===_||((h=t.frameCounter-1)!==this.frameCounterLastMove?(this.prevLeft=f,this.prevTop=y,this.frameCounterLastMove=h):(y=n(y*e+_*(1-e)),f=n(f*e+C*(1-e)))),t.insidePlayground(f,y,b,w)&&d&&v&&u&&m&&!l.hidden&&(r=this.animation_options.frameset[l.currentSpriteSheet],1!==v?(i=t.globalAlpha,t.globalAlpha*=v,G.globalAlpha=t.globalAlpha,a=!0):a=!1,l.blendMode?(s=G.globalCompositeOperation,G.globalCompositeOperation=l.blendMode,o=!0):o=!1,c||1!==u||1!==m?(G.save(),"string"==typeof p&&(p=this[p]),"string"==typeof g&&(g=this[g]),G.translate(f+p,y+g),c&&G.rotate(c),1===u&&1===m||G.scale(u,m),G.translate(-p,-g),t.safeDrawImage(G,r.img,r.offsetx+l.multix+x*r.deltax,r.offsety+l.multiy+x*r.deltay,b,w,0,0,b,w),G.restore()):t.safeDrawImage(G,r.img,r.offsetx+l.multix+x*r.deltax,r.offsety+l.multiy+x*r.deltay,b,w,f,y,b,w),o&&(G.globalCompositeOperation=s),a&&(G.globalAlpha=i,t.globalAlpha=i))}}),e.PSpriteGroup=t.pick(t.PSpriteGroup,["init","remove","draw"]),t.extend(t.PSpriteGroup,{init:function(i,a,s){var o,r,h,n;this.old_options={},s||((o=a.parentDOM).getContext?(this.dom=null,t.ctx=o.getContext("2d"),a.width=o.width||300,a.height=o.height||150):(r=a.width,h=a.height,(n=document.createElement("canvas")).id=t.domPrefix+i,n.width=r,n.height=h,o.insertBefore(n,o.firstChild),n.className=t.cssClass,t.extend(n.style,{left:"0px",top:"0px",width:String(r)+"px",height:String(h)+"px",overflow:"hidden"}),this.dom=n,t.ctx=n.getContext("2d"))),e.PSpriteGroup.init.apply(this,arguments),this.gradients={}},remove:function(){var t=this.options.background,i=this.old_options.background,a=this.options.borderColor,s=this.old_options.borderColor,o=this.dom;e.PSpriteGroup.remove.apply(this,arguments),i&&i.removeGroup&&i.removeGroup(this),t&&t.removeGroup&&t.removeGroup(this),s&&s.removeGroup&&s.removeGroup(this),a&&a.removeGroup&&a.removeGroup(this),o&&o.parentNode&&o.parentNode.removeChild(o)},draw:function(i){var a,s,o,r,h,n,l,d,p,g,c,u=Math.round,m=this.options,v=this.old_options,f=this.parent,y=this.left,b=this.top,w=this.width,C=this.height,_=this.prevLeft,x=this.prevTop,G=v.background,S=m.mask,k=m.borderTopLeftRadius,T=m.borderTopRightRadius,A=m.borderBottomRightRadius,O=m.borderBottomLeftRadius,P=k||T||A||O,R=m.borderWidth,M=R/2,I=v.borderColor,L=w!==v.width||C!==v.height,D=m.transformOriginx,E=m.transformOriginy,N=m.angle,B=m.scaleh,H=m.scalev,z=m.alpha,F=m.crop,Z=t.ctx;f||(Z.clearRect(0,0,w,C),t.globalAlpha=1),y===_&&b===x||((a=t.frameCounter-1)!==this.frameCounterLastMove?(this.prevLeft=y,this.prevTop=b,this.frameCounterLastMove=a):(b=u(b*i+x*(1-i)),y=u(y*i+_*(1-i)))),h=(o=(s=t.insidePlayground(y,b,w,C))&&m.background)!==G,n=(r=s&&R&&m.borderColor)!==I,s&&(h||n||L)&&((h||L)&&(G&&G.removeGroup&&(this.gradients[G.name]-=1,!L&&this.gradients[G.name]||G.removeGroup(this)),o&&o.addGroup&&(this.gradients[o.name]?this.gradients[o.name]+=1:this.gradients[o.name]=1,o.addGroup(Z,this)),v.background=o),(n||L)&&(I&&I.removeGroup&&(this.gradients[I.name]-=1,!L&&this.gradients[I.name]||I.removeGroup(this)),r&&r.addGroup&&(this.gradients[r.name]?this.gradients[r.name]+=1:this.gradients[r.name]=1,r.addGroup(Z,this)),v.borderColor=r),v.width=w,v.height=C),(this.layers.length||o||r)&&z&&B&&H&&!m.hidden&&(N||1!==B||1!==H?(Z.save(),c=!0,"string"==typeof D&&(D=this[D]),"string"==typeof E&&(E=this[E]),Z.translate(y+D,b+E),N&&Z.rotate(N),1===B&&1===H||Z.scale(B,H),Z.translate(-D,-E)):y||b?(Z.save(),c=!0,Z.translate(y,b)):c=!1,1!==z?(l=t.globalAlpha,t.globalAlpha*=z,Z.globalAlpha=t.globalAlpha,d=!0):d=!1,m.blendMode?(p=Z.globalCompositeOperation,Z.globalCompositeOperation=m.blendMode,g=!0):g=!1,(o||F)&&(Z.beginPath(),P?t.roundedRect(Z,0,0,w,C,k,T,A,O):Z.rect(0,0,w,C),Z.closePath()),o&&(S?S.drawMask(Z,this):o.drawBackground(Z,this)),r&&(Z.beginPath(),P?t.roundedRect(Z,-M,-M,w+R,C+R,k?k+M:0,T?T+M:0,A?A+M:0,O?O+M:0):Z.rect(-M,-M,w+R,C+R),Z.closePath(),r.setStrokeStyle(Z,this),Z.lineWidth=R,Z.stroke()),F&&(c||(Z.save(),c=!0),r&&(Z.beginPath(),P?t.roundedRect(Z,0,0,w,C,k,T,A,O):Z.rect(0,0,w,C),Z.closePath()),Z.clip()),e.PSpriteGroup.draw.apply(this,arguments),c?(Z.restore(),d&&(t.globalAlpha=l)):(g&&(Z.globalCompositeOperation=p),d&&(Z.globalAlpha=l,t.globalAlpha=l)))}}),t.safeDrawImage=function(t,e,i,a,s,o,r,h,n,l){e&&t&&(i<0&&(r-=n/s*i,s+=i,i=0),a<0&&(h-=l/o*a,o+=a,a=0),i+s>e.width&&(n=n/s*(e.width-i),s=e.width-i),a+o>e.height&&(l=l/o*(e.height-a),o=e.height-a),o>0&&s>0&&i<e.width&&a<e.height&&t.drawImage(e,i,a,s,o,r,h,n,l))},t.roundedRect=function(t,e,i,a,s,o,r,h,n){var l=Math.PI,d=l/2,p=e+a,g=i+s,c=e+o,u=p-r,m=g-h,v=e+n,f=i+o;t.moveTo(c,i),t.lineTo(u,i),r&&t.arc(u,i+r,r,-d,0,!1),t.lineTo(p,m),h&&t.arc(p-h,m,h,0,d,!1),t.lineTo(v,g),n&&t.arc(v,g-n,n,d,l,!1),t.lineTo(e,f),o&&t.arc(c,f,o,l,-d,!1)}}(friGame);