(function(t){"use strict";var e={},i=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();window.friGame=e,"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),Date.now||(Date.now=function(){return(new Date).getTime()}),window.performance||(window.performance={}),window.performance.now||(window.performance.now=function(){return window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||Date.now}()),t.extend(e,{GRADIENT_VERTICAL:0,GRADIENT_HORIZONTAL:1,ANIMATION_VERTICAL:0,ANIMATION_HORIZONTAL:1,BACKGROUND_TILED:0,BACKGROUND_STRETCHED:1,REFRESH_RATE:1e3/60}),t.extend(e,{cssClass:"friGame",domPrefix:"friGame_",resources:{},sprites:{},playgroundCallbacks:[],idUpdate:null,nextUpdate:0,needsRedraw:!1}),e.r=e.resources,e.s=e.sprites,t.extend(e,{Maker:function(t){return function(){var e=Object.create(t);return e.init.apply(e,arguments),e}},pick:function(t,e){var i,r,n=e.length,a={};for(r=0;n>r;r+=1)i=e[r],void 0!==t[i]&&(a[i]=t[i]);return a},truncate:function(t){return 0>t?Math.ceil(t):Math.floor(t)},clamp:function(t,e,i){return Math.min(Math.max(t,e),i)}}),e.resourceManager={idPreload:null,preloadList:[],loadCallback:null,startCallbacks:[],completeCallback:null,addResource:function(t,i){return e.resourceManager.preloadList.push(i),e.r[t]=i,e.resourceManager},removeResource:function(t){return e.r[t]&&(e.r[t].remove&&e.r[t].remove(),delete e.r[t]),e.resourceManager},clear:function(){var t,i,r,n=e.resourceManager,a=n.removeResource,s=e.r,o=[];for(t in s)s.hasOwnProperty(t)&&o.push(t);for(i=o.length,r=0;i>r;r+=1)a(o[r]);return n},preload:function(){var t,r=e.resourceManager,n=r.preloadList,a=n.length,s=0,o=r.loadCallback,h=r.startCallbacks,l=h.length,c=r.completeCallback;for(t=0;a>t;t+=1)(!n[t].complete||n[t].complete())&&(s+=1);if(o&&(0!==a?o.call(e,s/a):o.call(e,1)),s===a){for(o&&(r.loadCallback=null),null!==r.idPreload&&(clearInterval(r.idPreload),r.idPreload=null),t=0;a>t;t+=1)n[t].onLoad&&n[t].onLoad();for(n.splice(0,a),t=0;l>t;t+=1)h[t].call(e);h.splice(0,l),null===e.idUpdate&&e.s.playground&&(e.nextUpdate=performance.now()+e.REFRESH_RATE,e.idUpdate=setTimeout(e.update,4),i(e.draw)),c&&(r.completeCallback=null,c.call(e))}}},e.PGradient={init:function(i,r,n){var a=e.clamp,s=Math.round;this.startColor={r:0,g:0,b:0,a:1},i&&(i=t.extend(this.startColor,e.pick(i,["r","g","b","a"])),i.r=a(s(i.r),0,255),i.g=a(s(i.g),0,255),i.b=a(s(i.b),0,255),i.a=a(i.a,0,1),this.startColorStr=["rgba(",i.r+"",",",i.g+"",",",i.b+"",",",i.a+"",")"].join("")),r?(this.endColor={r:0,g:0,b:0,a:1},r=t.extend(this.endColor,e.pick(r,["r","g","b","a"])),r.r=a(s(r.r),0,255),r.g=a(s(r.g),0,255),r.b=a(s(r.b),0,255),r.a=a(r.a,0,1),this.endColorStr=["rgba(",r.r+"",",",r.g+"",",",r.b+"",",",r.a+"",")"].join(""),this.startColorStr===this.endColorStr&&(this.endColor=this.startColor)):(this.endColor=this.startColor,this.endColorStr=this.startColorStr),this.type=void 0!==n?n:e.GRADIENT_VERTICAL},remove:function(){var i=this;t.each(e.s,function(){this.options.background===i&&this.setBackground({background:null})})}},e.Gradient=e.Maker(e.PGradient),e.resourceManager.addGradient=function(t){var i=Array.prototype.slice.call(arguments,1),r=e.Gradient.apply(this,i);return r.name=t,e.resourceManager.addResource(t,r)},e.PAnimation={images:{},init:function(i,r){var n,a,s=r||{},o=e.PAnimation;this.options?n=this.options:(n={},this.options=n),t.extend(n,{numberOfFrame:1,rate:e.REFRESH_RATE,type:e.ANIMATION_HORIZONTAL,once:!1,pingpong:!1,backwards:!1,offsetx:0,offsety:0,frameWidth:0,frameHeight:0,imageURL:"",img:null,halfWidth:0,halfHeight:0,deltax:0,deltay:0,multix:0,multiy:0}),s=t.extend(n,e.pick(s,["numberOfFrame","rate","type","once","pingpong","backwards","offsetx","offsety","frameWidth","frameHeight"])),s.rate=Math.round(s.rate/e.REFRESH_RATE)||1,n.rate=s.rate,n.imageURL=i,o.images[i]?(a=o.images[i].img,o.images[i].refCount+=1):(a=new Image,a.src=i,o.images[i]={img:a,refCount:1}),n.img=a},remove:function(){var i=this.options.imageURL,r=e.PAnimation,n=this;t.each(e.s,function(){this.options.animation===n&&this.setAnimation({animation:null}),this.options.background===n&&this.setBackground({background:null})}),r.images[i].refCount-=1,0>=r.images[i].refCount&&delete r.images[i]},complete:function(){return this.options.img.complete},onLoad:function(){var t=this.options,i=t.img,r=e.truncate;t.type===e.ANIMATION_VERTICAL?(t.frameWidth||(t.frameWidth=i.width-t.offsetx),t.frameHeight||(t.frameHeight=r((i.height-t.offsety)/t.numberOfFrame)),t.deltax=0,t.deltay=t.frameHeight,t.multix=t.frameWidth,t.multiy=0):(t.frameWidth||(t.frameWidth=r((i.width-t.offsetx)/t.numberOfFrame)),t.frameHeight||(t.frameHeight=i.height-t.offsety),t.deltax=t.frameWidth,t.deltay=0,t.multix=0,t.multiy=t.frameHeight),t.halfWidth=r(t.frameWidth/2),t.halfHeight=r(t.frameHeight/2),this.width=t.frameWidth,this.height=t.frameHeight,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight}},e.Animation=e.Maker(e.PAnimation),e.resourceManager.addAnimation=function(t){var i=Array.prototype.slice.call(arguments,1),r=e.Animation.apply(this,i);return r.name=t,e.resourceManager.addResource(t,r)},e.PRect={init:function(e){t.extend(this,{left:0,right:0,centerx:0,top:0,bottom:0,centery:0,width:0,height:0,halfWidth:0,halfHeight:0,radius:0,last_x:"left",last_y:"top"}),this.resize&&this.resize(e)},resize:function(t){var i,r=t||{},n=e.truncate;return void 0!==r.width?(this.width=n(r.width),this.halfWidth=n(r.width/2),i=!0):void 0!==r.halfWidth?(this.width=n(2*r.halfWidth),this.halfWidth=n(r.halfWidth),i=!0):i=!1,void 0!==r.height?(this.height=n(r.height),this.halfHeight=n(r.height/2),i=!0):void 0!==r.halfHeight?(this.height=n(2*r.halfHeight),this.halfHeight=n(r.halfHeight),i=!0):i=!1,i?this.radius=Math.max(this.halfWidth,this.halfHeight):void 0!==r.radius&&(this.radius=n(r.radius),this.width=2*this.radius,this.height=this.width,this.halfWidth=this.radius,this.halfHeight=this.halfWidth),this.move&&this.move(t),this},move:function(t){var i,r,n=t||{},a=e.truncate;return void 0!==n.last_x&&void 0!==n[n.last_x]?(this[n.last_x]=a(n[n.last_x]),i=n.last_x):void 0!==n.centerx?(this.centerx=a(n.centerx),i="centerx"):void 0!==n.right?(this.right=a(n.right),i="right"):void 0!==n.left?(this.left=a(n.left),i="left"):i=this.last_x,void 0!==n.last_y&&void 0!==n[n.last_y]?(this[n.last_y]=a(n[n.last_y]),r=n.last_y):void 0!==n.centery?(this.centery=a(n.centery),r="centery"):void 0!==n.bottom?(this.bottom=a(n.bottom),r="bottom"):void 0!==n.top?(this.top=a(n.top),r="top"):r=this.last_y,"centerx"===i?(this.left=this.centerx-this.halfWidth,this.right=this.left+this.width):"right"===i?(this.left=this.right-this.width,this.centerx=this.left+this.halfWidth):(this.centerx=this.left+this.halfWidth,this.right=this.left+this.width),"centery"===r?(this.top=this.centery-this.halfHeight,this.bottom=this.top+this.height):"bottom"===r?(this.top=this.bottom-this.height,this.centery=this.top+this.halfHeight):(this.centery=this.top+this.halfHeight,this.bottom=this.top+this.height),this.last_x=i,this.last_y=r,this},collidePointRect:function(t,e){return t>=this.left&&this.right>t&&e>=this.top&&this.bottom>e},collideRect:function(t){var e=this.left,i=this.right,r=this.top,n=this.bottom,a=t.left,s=t.right,o=t.top,h=t.bottom;return(e>=a&&s>e||a>=e&&i>a)&&(r>=o&&h>r||o>=r&&n>o)},collidePointCircle:function(t,e){var i=t-this.centerx,r=e-this.centery,n=this.radius;return n*n>i*i+r*r},collideCircle:function(t){var e=t.centerx-this.centerx,i=t.centery-this.centery,r=this.radius+t.radius;return r*r>e*e+i*i}},e.Rect=e.Maker(e.PRect),e.PBaseSprite=Object.create(e.PRect),t.extend(e.PBaseSprite,{init:function(i,r,n){var a;this.options?a=this.options:(a={},this.options=a),t.extend(a,{angle:0,scalex:1,scaley:1,fliph:1,flipv:1,alpha:1,hidden:!1,scaleh:1,scalev:1,posOffsetX:0,posOffsetY:0}),e.s[i]=this,this.name=i,this.parent=n,this.absRect=e.Rect(r),this.userData=null,this.callbacks=[],e.PRect.init.call(this,r)},remove:function(){var t,i,r,n=this.parent,a=this.name;if(n)for(t=e.s[n].layers,i=t.length,r=0;i>r;r+=1)if(t[r].name===a){t.splice(r,1);break}delete e.s[a]},resize:function(t){return this.absRect.resize(t),e.PRect.resize.call(this,t),this},move:function(t){var i,r=this.absRect;return e.PRect.move.call(this,t),this.parent?(i=e.s[this.parent].absRect,r.move({left:i.left+this.left,top:i.top+this.top}),this.insidePlayground=r.collideRect(e.s.playground)):(r.move({left:this.left,top:this.top}),this.insidePlayground=!0),this},registerCallback:function(t,i){return i=Math.round(i/e.REFRESH_RATE)||1,this.callbacks.push({callback:t,rate:i,idleCounter:0}),this},removeCallback:function(t){var e,i,r=this.callbacks,n=r.length,a=[];for(i=0;n>i;i+=1)r[i].callback===t&&a.unshift(i);for(e=a.length,i=0;e>i;i+=1)r.splice(a[i],1);return this},clearCallbacks:function(){return this.callbacks.splice(0,this.callbacks.length),this},hide:function(){return this.options.hidden=!0,this},show:function(){return this.options.hidden=!1,this},toggle:function(t){return void 0===t&&(t=this.options.hidden),this.options.hidden=!t,this},drawFirst:function(){var t,i,r,n,a=this.parent,s=this.name;if(a){for(t=e.s[a].layers,i=t.length,n=0;i>n;n+=1)if(t[n].name===s){r=t.splice(n,1)[0];break}r&&t.unshift(r)}return this},drawLast:function(){var t,i,r,n,a=this.parent,s=this.name;if(a){for(t=e.s[a].layers,i=t.length,n=0;i>n;n+=1)if(t[n].name===s){r=t.splice(n,1)[0];break}r&&t.push(r)}return this},drawTo:function(t){var i,r,n,a,s=this.parent,o=this.name;if(s){for(i=e.s[s].layers,r=i.length,a=0;r>a;a+=1)if(i[a].name===o){n=i.splice(a,1)[0];break}n&&i.splice(e.clamp(Math.round(t),0,i.length),0,n)}return this},drawBefore:function(t){var i,r,n,a,s=this.parent,o=this.name;if(s){for(i=e.s[s].layers,r=i.length,a=0;r>a;a+=1)if(i[a].name===o){n=i.splice(a,1)[0],r-=1;break}for(a=0;r>a&&i[a].name!==t;a+=1);n&&i.splice(a,0,n)}return this},drawAfter:function(t){var i,r,n,a,s=this.parent,o=this.name;if(s){for(i=e.s[s].layers,r=i.length,a=0;r>a;a+=1)if(i[a].name===o){n=i.splice(a,1)[0],r-=1;break}for(a=0;r>a;a+=1)if(i[a].name===t){a+=1;break}n&&i.splice(a,0,n)}return this},rotate:function(t){return void 0===t?this.options.angle:(this.options.angle=t,this)},scale:function(t,e){var i=this.options;return void 0===t?i.scalex:(i.scalex=t,i.scaleh=t*i.fliph,void 0===e?(i.scaley=t,i.scalev=t*i.flipv):(i.scaley=e,i.scalev=e*i.flipv),this)},scalex:function(t){var e=this.options;return void 0===t?e.scalex:(e.scalex=t,e.scaleh=t*e.fliph,this)},scaley:function(t){var e=this.options;return void 0===t?e.scaley:(e.scaley=t,e.scalev=t*e.flipv,this)},fliph:function(t){var e=this.options;return void 0===t?0>e.fliph:(t?(e.fliph=-1,e.scaleh=-e.scalex):(e.fliph=1,e.scaleh=e.scalex),this)},flipv:function(t){var e=this.options;return void 0===t?0>e.flipv:(t?(e.flipv=-1,e.scalev=-e.scaley):(e.flipv=1,e.scalev=e.scaley),this)},opacity:function(t){return void 0===t?this.options.alpha:(this.options.alpha=e.clamp(t,0,1),this)},update:function(){var t,e,i,r,n=this.callbacks,a=n.length,s=[];for(r=0;a>r;r+=1)t=n[r],t.idleCounter+=1,t.idleCounter>=t.rate&&(t.idleCounter=0,e=t.callback.call(this,this),e&&s.unshift(r));for(i=s.length,r=0;i>r;r+=1)n.splice(s[r],1)}}),e.PSprite=Object.create(e.PBaseSprite),t.extend(e.PSprite,{init:function(i,r){var n,a=r||{};this.options?n=this.options:(n={},this.options=n),t.extend(n,{animation:null,animationIndex:0,callback:null,idleCounter:0,currentFrame:0,frameIncrement:1,multix:0,multiy:0,paused:!1}),e.PBaseSprite.init.apply(this,arguments),void 0===a.animation&&(a.animation=null),this.setAnimation(a)},setAnimation:function(t){var i,r,n,a=this.options,s=t||{},o=void 0!==s.animation,h=void 0!==s.animationIndex;return o&&(i=e.r[s.animation],a.animation=i,i?(n=Object.create(i.options),s.width=n.frameWidth,s.height=n.frameHeight):(n=null,s.width=0,s.height=0),this.animation_options=n,e.PBaseSprite.resize.call(this,s),0===a.animationIndex||h||(s.animationIndex=0,h=!0)),n=this.animation_options,h&&(r=s.animationIndex,a.animationIndex=r,i=a.animation,i?(a.multix=r*n.multix,a.multiy=r*n.multiy):(a.multix=0,a.multiy=0)),void 0!==s.rate&&(n.rate=Math.round(s.rate/e.REFRESH_RATE)||1,o=!0),void 0!==s.once&&(n.once=s.once,o=!0),void 0!==s.pingpong&&(n.pingpong=s.pingpong,o=!0),void 0!==s.backwards&&(n.backwards=s.backwards,o=!0),(o||h)&&(n&&n.backwards?(a.currentFrame=n.numberOfFrame-1,a.frameIncrement=-1):(a.currentFrame=0,a.frameIncrement=1),a.idleCounter=0,this.endAnimation=!1),void 0!==s.callback&&(a.callback=s.callback),void 0!==s.paused&&(a.paused=s.paused),this},resize:null,update:function(){var t=this.options,i=t.callback,r=t.animation,n=this.animation_options,a=t.currentFrame;e.PBaseSprite.update.call(this),this.endAnimation||t.paused||(r?(t.idleCounter+=1,t.idleCounter>=n.rate&&(t.idleCounter=0,a+=t.frameIncrement,n.backwards?n.pingpong?a>=n.numberOfFrame?(t.frameIncrement=-1,n.once?(a-=1,t.idleCounter=1,this.endAnimation=!0):a-=n.numberOfFrame>1?2:1,t.currentFrame=a,i&&i.call(this,this)):0>a?(t.frameIncrement=1,a=n.numberOfFrame>1?1:0,t.currentFrame=a):t.currentFrame=a:0>a?(n.once?(a=0,t.idleCounter=1,this.endAnimation=!0):a=n.numberOfFrame-1,t.currentFrame=a,i&&i.call(this,this)):t.currentFrame=a:n.pingpong?0>a?(t.frameIncrement=1,n.once?(a=0,t.idleCounter=1,this.endAnimation=!0):a=n.numberOfFrame>1?1:0,t.currentFrame=a,i&&i.call(this,this)):a>=n.numberOfFrame?(t.frameIncrement=-1,a-=n.numberOfFrame>1?2:1,t.currentFrame=a):t.currentFrame=a:a>=n.numberOfFrame?(n.once?(a-=1,t.idleCounter=1,this.endAnimation=!0):a=0,t.currentFrame=a,i&&i.call(this,this)):t.currentFrame=a)):i&&i.call(this,this))}}),e.Sprite=e.Maker(e.PSprite),e.PSpriteGroup=Object.create(e.PBaseSprite),t.extend(e.PSpriteGroup,{init:function(i,r){var n,a=r||{};this.options?n=this.options:(n={},this.options=n),t.extend(n,{background:null,backgroundType:e.BACKGROUND_TILED,crop:!1}),a.parentDOM&&(this.parentDOM=a.parentDOM),this.layers=[],e.PBaseSprite.init.apply(this,arguments),void 0===a.background&&(a.background=null),this.setBackground(a)},remove:function(){this.clear(),e.PBaseSprite.remove.apply(this,arguments)},resize:function(t){var i,r={},n=!1;return e.PBaseSprite.resize.call(this,t),this.parent&&(i=e.s[this.parent],this.width||(r.width=i.width,n=!0),this.height||(r.height=i.height,n=!0),n&&e.PBaseSprite.resize.call(this,r)),this},move:function(t){return e.PBaseSprite.move.call(this,t),this.moveChildrenAbsRect(),this},clear:function(){for(var t=this.layers;t.length;)t[0].obj.remove();return this},children:function(t){var e,i,r,n,a=this.layers,s=a.length;if(t)for(n=0;s>n&&(e=a[n],!(e&&(i=e.obj,r=t.call(i,i))));n+=1);return this},setBackground:function(t){var i=this.options,r=t||{};return void 0!==r.background&&(i.background=e.r[r.background]),void 0!==r.backgroundType&&(i.backgroundType=r.backgroundType),this},crop:function(t){var e=this.options;return void 0===t?e.crop:(e.crop=t,this)},addSprite:function(t,i){var r=e.Sprite(t,i,this.name);return this.layers.push({name:t,obj:r}),this},insertSprite:function(t,i){var r=e.Sprite(t,i,this.name);return this.layers.unshift({name:t,obj:r}),this},addGroup:function(t,i){var r=e.SpriteGroup(t,i,this.name);return this.layers.push({name:t,obj:r}),r},insertGroup:function(t,i){var r=e.SpriteGroup(t,i,this.name);return this.layers.unshift({name:t,obj:r}),r},end:function(){var t=this.parent;return t||(t=this.name),e.s[t]},update:function(){var t,i=this.layers,r=i.length;for(e.PBaseSprite.update.call(this),t=0;r>t;t+=1)i[t]&&i[t].obj.update()},draw:function(){var t,e=this.layers,i=e.length;for(t=0;i>t;t+=1)e[t].obj.draw()},moveChildrenAbsRect:function(){var t,i,r,n=this.absRect,a=n.left,s=n.top,o=e.s.playground,h=this.layers,l=h.length;for(r=0;l>r;r+=1)t=h[r].obj,i=t.absRect,i.move({left:a+t.left,top:s+t.top}),t.insidePlayground=i.collideRect(o),t.moveChildrenAbsRect&&t.moveChildrenAbsRect()}}),e.SpriteGroup=e.Maker(e.PSpriteGroup),t.extend(e,{playground:function(r){var n,a,s=e.s.playground,o=e.playgroundCallbacks,h=o.length;if(!s){for(a=r?t(r):t("#playground"),s=e.SpriteGroup("playground",{width:a.width(),height:a.height(),parentDOM:a},""),s.resize=null,s.move=null,s.crop=null,n=0;h>n;n+=1)o[n].call(s,a);o.splice(0,h),null===e.idUpdate&&(e.nextUpdate=performance.now()+e.REFRESH_RATE,e.idUpdate=setTimeout(e.update,4),i(e.draw))}return s},startGame:function(t){var i=e.resourceManager;return t&&(i.completeCallback=t),i.preload(),null===i.idPreload&&(i.idPreload=setInterval(i.preload,100)),this},stopGame:function(){return null!==e.idUpdate&&(clearTimeout(e.idUpdate),e.idUpdate=null),this},loadCallback:function(t){return e.resourceManager.loadCallback=t,this},startCallback:function(t){return e.resourceManager.startCallbacks.push(t),this},playgroundCallback:function(t){return e.playgroundCallbacks.push(t),this},update:function(){var t=e.s.playground,i=performance.now(),r=e.nextUpdate,n=e.REFRESH_RATE;if(i-r>=n){for(;i-r>=n;)t.update(),r+=n;e.nextUpdate=r,e.needsRedraw=!0}e.idUpdate=setTimeout(e.update,4)},draw:function(){var t=e.s.playground;null!==e.idUpdate&&i(e.draw),e.needsRedraw&&(t.draw(),e.needsRedraw=!1)}})})(jQuery);