!function(){"use strict";var e,t={};window.friGame=t,Date.now||(Date.now=function(){return(new Date).getTime()}),window.performance||(window.performance={}),window.performance.now||(window.performance.now=function(){return window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||Date.now}()),e=function(){var e,t=0,r=["ms","moz","webkit","o"],i=window.requestAnimationFrame;for(e=0;e<r.length&&!i;e+=1)i=window[r[e]+"RequestAnimationFrame"];return i||(i=function(e){var r=performance.now(),i=Math.max(0,16-(r-t)),a=window.setTimeout(function(){e(r+i)},i);return t=r+i,a}),i}(),"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),t.extend=function(e,t){var r,i;if(t)for(r in t)i=t[r],e!==i&&void 0!==i&&(e[r]=i);return e},t.extend(t,{GRADIENT_VERTICAL:0,GRADIENT_HORIZONTAL:1,ANIMATION_VERTICAL:0,ANIMATION_HORIZONTAL:1,BACKGROUND_TILED:0,BACKGROUND_STRETCHED:1,REFRESH_RATE:1e3/60}),t.extend(t,{cssClass:"friGame",domPrefix:"friGame_",resources:{},sprites:{},playgroundCallbacks:[],running:!1,idDraw:null,currentTime:0,accumulator:0,absLeft:0,absTop:0,frameCounter:0}),t.r=t.resources,t.s=t.sprites,t.extend(t,{Maker:function(e){return function(){var t=Object.create(e);return t.init.apply(t,arguments),t}},noop:function(){},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},each:function(e,t){var r,i,a=e.length;if(a>=0)for(i=0;a>i&&(r=e[i],t.call(r,i,r)!==!1);i+=1);else for(i in e)if(r=e[i],t.call(r,i,r)===!1)break;return e},pick:function(e,t){var r,i,a=t.length,n={};for(i=0;a>i;i+=1)r=t[i],void 0!==e[r]&&(n[r]=e[r]);return n},inArray:function(e,t,r){var i;if(t)for(i=t.length,r=r||0,0>r&&(r=Math.max(0,i+r));i>r;){if(t[r]===e)return r;r+=1}return-1},truncate:function(e){return 0>e?Math.ceil(e):Math.floor(e)},clamp:function(e,t,r){return Math.min(Math.max(e,t),r)}}),t.resourceManager={idPreload:null,preloadList:[],loadCallback:null,startCallbacks:[],completeCallback:null,addResource:function(e,r){return window.console&&t.r[e]&&(console.error("Resource with name "+e+" already exists"),console.trace()),t.resourceManager.preloadList.push(r),t.r[e]=r,t.resourceManager},removeResource:function(e){var r,i=t.r[e],a=t.resourceManager,n=a.preloadList,o=n.length;if(i){for(i.remove&&i.remove(),r=0;o>r;r+=1)if(n[r]===i){n.splice(r,1);break}t.r[e]=null,delete t.r[e]}else window.console&&(console.warn("Resource with name "+e+" already removed"),console.trace());return a},clear:function(){var e,r,i,a=t.resourceManager,n=a.removeResource,o=t.r,s=[];for(e in o)o.hasOwnProperty(e)&&s.push(e);for(r=s.length,i=0;r>i;i+=1)n(s[i]);return a},preload:function(){var r,i=t.resourceManager,a=i.preloadList,n=a.length,o=0,s=i.loadCallback,h=i.startCallbacks,l=h.length,u=i.completeCallback;for(r=0;n>r;r+=1)(!a[r].complete||a[r].complete())&&(o+=1);if(s&&(0!==n?s.call(t,o/n):s.call(t,1)),o===n){for(s&&(i.loadCallback=null),null!==i.idPreload&&(clearInterval(i.idPreload),i.idPreload=null),r=0;n>r;r+=1)a[r].onLoad&&a[r].onLoad();for(a.splice(0,n),r=0;l>r;r+=1)h[r].call(t);h.splice(0,l),t.running&&null===t.idDraw&&t.s.playground&&(t.accumulator=0,t.currentTime=performance.now(),t.idDraw=e(t.draw)),u&&(i.completeCallback=null,u.call(t))}}},t.PGradient={init:function(e,r,i){var a=t.clamp,n=Math.round;this.startColor={r:0,g:0,b:0,a:1},e&&(e=t.extend(this.startColor,t.pick(e,["r","g","b","a"])),e.r=a(n(e.r),0,255),e.g=a(n(e.g),0,255),e.b=a(n(e.b),0,255),e.a=a(e.a,0,1),this.startColorStr="rgba("+String(e.r)+","+String(e.g)+","+String(e.b)+","+String(e.a)+")"),r?(this.endColor={r:0,g:0,b:0,a:1},r=t.extend(this.endColor,t.pick(r,["r","g","b","a"])),r.r=a(n(r.r),0,255),r.g=a(n(r.g),0,255),r.b=a(n(r.b),0,255),r.a=a(r.a,0,1),this.endColorStr="rgba("+String(r.r)+","+String(r.g)+","+String(r.b)+","+String(r.a)+")",this.startColorStr===this.endColorStr&&(this.endColor=this.startColor)):(this.endColor=this.startColor,this.endColorStr=this.startColorStr),void 0!==i?this.type=i:this.type=t.GRADIENT_VERTICAL},remove:function(){var e=this;t.each(t.s,function(){this.options.background===e&&this.setBackground({background:null})})}},t.Gradient=t.Maker(t.PGradient),t.resourceManager.addGradient=function(e){var r=Array.prototype.slice.call(arguments,1),i=t.Gradient.apply(this,r);return i.name=e,t.resourceManager.addResource(e,i)},t.PAnimation={images:{},init:function(e,r){var i,a,n,o,s,h,l;if(e&&"string"!=typeof e&&(r=e,e=null),a=r||{},this.options?i=this.options:(i={},this.options=i),t.extend(i,{rate:t.REFRESH_RATE,once:!1,pingpong:!1,backwards:!1,frameWidth:0,frameHeight:0,frameset:[],halfWidth:0,halfHeight:0}),t.extend(i,t.pick(a,["rate","once","pingpong","backwards","frameWidth","frameHeight"])),i.rate=Math.max(Math.round(a.rate/t.REFRESH_RATE),1)||1,o=i.frameset,e&&(n={imageURL:e,numberOfFrame:1,type:t.ANIMATION_HORIZONTAL,offsetx:0,offsety:0},t.extend(n,t.pick(a,["numberOfFrame","type","offsetx","offsety"])),n.img=this.getImage(e),o.push(n)),s=a.frameset,s&&(h=s.length))for(e||(e=s[0].imageURL),l=0;h>l;l+=1)n={imageURL:e,numberOfFrame:1,type:t.ANIMATION_HORIZONTAL,offsetx:0,offsety:0},t.extend(n,t.pick(s[l],["imageURL","numberOfFrame","type","offsetx","offsety"])),n.img=this.getImage(n.imageURL),o.push(n)},remove:function(){var e,r,i=t.PAnimation,a=this,n=this.options.frameset,o=n.length;for(t.each(t.s,function(){this.options.animation===a&&this.setAnimation({animation:null}),this.options.background===a&&this.setBackground({background:null})}),r=0;o>r;r+=1)e=n[r].imageURL,i.images[e].refCount-=1,i.images[e].refCount<=0&&(i.images[e]=null,delete i.images[e])},complete:function(){var e,t,r=!0,i=this.options.frameset,a=i.length;for(t=0;a>t;t+=1)if(e=i[t].img,!(e.complete&&e.width&&e.height)){r=!1;break}return r},onLoad:function(){var e,r,i,a,n,o=this.options,s=t.truncate,h=o.frameset,l=h.length;for(l&&(a=h[0],e=a.img,a.type===t.ANIMATION_VERTICAL?(o.frameWidth||(o.frameWidth=e.width-a.offsetx),o.frameHeight||(o.frameHeight=s((e.height-a.offsety)/a.numberOfFrame))):(o.frameWidth||(o.frameWidth=s((e.width-a.offsetx)/a.numberOfFrame)),o.frameHeight||(o.frameHeight=e.height-a.offsety))),r=o.frameWidth,i=o.frameHeight,n=0;l>n;n+=1)a=h[n],a.type===t.ANIMATION_VERTICAL?(a.deltax=0,a.deltay=i,a.multix=r,a.multiy=0):(a.deltax=r,a.deltay=0,a.multix=0,a.multiy=i);o.halfWidth=s(r/2),o.halfHeight=s(i/2),this.width=r,this.height=i,this.halfWidth=o.halfWidth,this.halfHeight=o.halfHeight},getImage:function(e){var r,i=t.PAnimation;return i.images[e]?(r=i.images[e].img,i.images[e].refCount+=1):(r=new Image,r.src=e,i.images[e]={img:r,refCount:1}),r}},t.Animation=t.Maker(t.PAnimation),t.resourceManager.addAnimation=function(e){var r=Array.prototype.slice.call(arguments,1),i=t.Animation.apply(this,r);return i.name=e,t.resourceManager.addResource(e,i)},t.PRect={init:function(e){t.extend(this,{left:0,right:0,centerx:0,top:0,bottom:0,centery:0,width:0,height:0,halfWidth:0,halfHeight:0,radius:0,last_x:"left",last_y:"top"}),this.resize&&this.resize(e)},resize:function(e){var r,i=e||{},a=t.truncate,n=Math.max;return void 0!==i.width?(this.width=n(a(i.width),0)||0,this.halfWidth=n(a(i.width/2),0)||0,r=!0):void 0!==i.halfWidth?(this.width=n(a(2*i.halfWidth),0)||0,this.halfWidth=n(a(i.halfWidth),0)||0,r=!0):r=!1,void 0!==i.height?(this.height=n(a(i.height),0)||0,this.halfHeight=n(a(i.height/2),0)||0,r=!0):void 0!==i.halfHeight?(this.height=n(a(2*i.halfHeight),0)||0,this.halfHeight=n(a(i.halfHeight),0)||0,r=!0):r=!1,r?this.radius=n(this.halfWidth,this.halfHeight):void 0!==i.radius&&(this.radius=n(a(i.radius),0)||0,this.width=2*this.radius,this.height=this.width,this.halfWidth=this.radius,this.halfHeight=this.halfWidth),this.move&&this.move(e),this},move:function(e){var r,i,a=e||{},n=t.truncate;return void 0!==a.last_x&&void 0!==a[a.last_x]?(this[a.last_x]=n(a[a.last_x]),r=a.last_x):void 0!==a.centerx?(this.centerx=n(a.centerx),r="centerx"):void 0!==a.right?(this.right=n(a.right),r="right"):void 0!==a.left?(this.left=n(a.left),r="left"):r=this.last_x,void 0!==a.last_y&&void 0!==a[a.last_y]?(this[a.last_y]=n(a[a.last_y]),i=a.last_y):void 0!==a.centery?(this.centery=n(a.centery),i="centery"):void 0!==a.bottom?(this.bottom=n(a.bottom),i="bottom"):void 0!==a.top?(this.top=n(a.top),i="top"):i=this.last_y,"centerx"===r?(this.left=this.centerx-this.halfWidth,this.right=this.left+this.width):"right"===r?(this.left=this.right-this.width,this.centerx=this.left+this.halfWidth):(this.centerx=this.left+this.halfWidth,this.right=this.left+this.width),"centery"===i?(this.top=this.centery-this.halfHeight,this.bottom=this.top+this.height):"bottom"===i?(this.top=this.bottom-this.height,this.centery=this.top+this.halfHeight):(this.centery=this.top+this.halfHeight,this.bottom=this.top+this.height),this.last_x=r,this.last_y=i,this},collidePointRect:function(e,t){return e>=this.left&&e<this.right&&t>=this.top&&t<this.bottom},collideRect:function(e){return!(this.bottom<=e.top||this.top>=e.bottom||this.left>=e.right||this.right<=e.left)},collidePointCircle:function(e,t){var r=e-this.centerx,i=t-this.centery,a=this.radius;return a*a>r*r+i*i},collideCircle:function(e){var t=e.centerx-this.centerx,r=e.centery-this.centery,i=this.radius+e.radius;return i*i>t*t+r*r}},t.Rect=t.Maker(t.PRect),t.PBaseSprite=Object.create(t.PRect),t.extend(t.PBaseSprite,{init:function(e,r,i){var a;this.options?a=this.options:(a={},this.options=a),t.extend(a,{angle:0,scalex:1,scaley:1,fliph:1,flipv:1,alpha:1,hidden:!1,scaleh:1,scalev:1,posOffsetX:0,posOffsetY:0}),window.console&&t.s[e]&&(console.error("Sprite with name "+e+" already exists"),console.trace()),t.s[e]=this,this.name=e,this.parent=i,this.userData=null,this.callbacks=[],this.needsUpdate=!1,this.frameCounterLastMove=t.frameCounter,this.prevLeft=0,this.prevTop=0,t.PRect.init.call(this,r),this.prevLeft=this.left,this.prevTop=this.top},remove:function(){var e,r,i,a,n,o=this.parent,s=this.name,h=this.userData;if(this.userData=null,h&&h.remove&&h.remove(),o&&!t.s[o].clearing){for(e=t.s[o].layers,r=e.length,n=0;r>n;n+=1)if(e[n].name===s){e.splice(n,1);break}for(this.needsUpdate=!1,i=t.s[o].updateList,a=i.length,n=0;a>n;n+=1)if(i[n].name===s){i.splice(n,1);break}}t.s[s]?(t.s[s]=null,delete t.s[s]):window.console&&(console.warn("Sprite with name "+s+" already removed"),console.trace())},registerCallback:function(e,r){return r=Math.max(Math.round(r/t.REFRESH_RATE),1)||1,this.callbacks.push({callback:e,rate:r,idleCounter:0,remove:!1}),this.checkUpdate(),this},removeCallback:function(e,t){var r,i,a=t||{},n=!1,o=this.callbacks,s=o.length;for(i=0;s>i;i+=1)r=o[i],r.callback===e&&(n=!0,r.remove=!0);return!window.console||n||a.suppressWarning||(console.warn("No callbacks removed"),console.trace()),this},clearCallbacks:function(){var e,t=this.callbacks,r=t.length;for(e=0;r>e;e+=1)t[e].remove=!0;return this},hide:function(){return this.options.hidden=!0,this},show:function(){return this.options.hidden=!1,this},toggle:function(e){return void 0===e&&(e=this.options.hidden),this.options.hidden=!e,this},drawFirst:function(){var e,r,i,a,n=this.parent,o=this.name;if(n){for(e=t.s[n].layers,r=e.length,a=0;r>a;a+=1)if(e[a].name===o){i=e.splice(a,1)[0];break}i&&e.unshift(i)}return this},drawLast:function(){var e,r,i,a,n=this.parent,o=this.name;if(n){for(e=t.s[n].layers,r=e.length,a=0;r>a;a+=1)if(e[a].name===o){i=e.splice(a,1)[0];break}i&&e.push(i)}return this},getDrawIndex:function(){var e,r,i,a=this.parent,n=this.name;if(a)for(e=t.s[a].layers,r=e.length,i=0;r>i;i+=1)if(e[i].name===n)return i;return 0},drawTo:function(e){var r,i,a,n,o=this.parent,s=this.name;if(o){for(r=t.s[o].layers,i=r.length,n=0;i>n;n+=1)if(r[n].name===s){a=r.splice(n,1)[0];break}a&&r.splice(t.clamp(Math.round(e),0,r.length),0,a)}return this},drawBefore:function(e){var r,i,a,n,o=!1,s=this.parent,h=this.name;if(s){for(r=t.s[s].layers,i=r.length,n=0;i>n;n+=1)if(r[n].name===h){a=r.splice(n,1)[0],i-=1;break}for(n=0;i>n;n+=1)if(r[n].name===e){o=!0;break}a&&r.splice(n,0,a)}return window.console&&!o&&(console.error("Sprite with name "+e+" not found in the same sprite group"),console.trace()),this},drawAfter:function(e){var r,i,a,n,o=!1,s=this.parent,h=this.name;if(s){for(r=t.s[s].layers,i=r.length,n=0;i>n;n+=1)if(r[n].name===h){a=r.splice(n,1)[0],i-=1;break}for(n=0;i>n;n+=1)if(r[n].name===e){o=!0,n+=1;break}a&&r.splice(n,0,a)}return window.console&&!o&&(console.error("Sprite with name "+e+" not found in the same sprite group"),console.trace()),this},rotate:function(e){return void 0===e?this.options.angle:(this.options.angle=e,this)},scale:function(e,t){var r=this.options;return void 0===e?r.scalex:(r.scalex=e,r.scaleh=e*r.fliph,void 0===t?(r.scaley=e,r.scalev=e*r.flipv):(r.scaley=t,r.scalev=t*r.flipv),this)},scalex:function(e){var t=this.options;return void 0===e?t.scalex:(t.scalex=e,t.scaleh=e*t.fliph,this)},scaley:function(e){var t=this.options;return void 0===e?t.scaley:(t.scaley=e,t.scalev=e*t.flipv,this)},fliph:function(e){var t=this.options;return void 0===e?t.fliph<0:(e?(t.fliph=-1,t.scaleh=-t.scalex):(t.fliph=1,t.scaleh=t.scalex),this)},flipv:function(e){var t=this.options;return void 0===e?t.flipv<0:(e?(t.flipv=-1,t.scalev=-t.scaley):(t.flipv=1,t.scalev=t.scaley),this)},opacity:function(e){return void 0===e?this.options.alpha:(this.options.alpha=t.clamp(e,0,1),this)},getAbsRect:function(){for(var e=this.left,r=this.top,i=t.s[this.parent];i;)e+=i.left,r+=i.top,i=t.s[i.parent];return t.Rect({left:e,top:r,width:this.width,height:this.height})},move:function(e){var r=t.frameCounter;r!==this.frameCounterLastMove&&(this.prevLeft=this.left,this.prevTop=this.top,this.frameCounterLastMove=r),t.PRect.move.apply(this,arguments)},checkUpdate:function(){var e=this.needsUpdate;0===this.callbacks.length?this.needsUpdate=!1:this.needsUpdate=!0,this.updateNeedsUpdate(e)},updateNeedsUpdate:function(e){var r,i,a,n=this.parent,o=this.name;if(n)if(this.needsUpdate&&!e)t.s[n].updateList.push({name:o,obj:this});else if(!this.needsUpdate&&e)for(r=t.s[n].updateList,i=r.length,a=0;i>a;a+=1)if(r[a].name===o){r.splice(a,1);break}},update:function(){var e,t,r,i,a=this.callbacks,n=a.length,o=[];for(i=0;n>i;i+=1)e=a[i],e.remove?o.unshift(i):(e.idleCounter+=1,e.idleCounter>=e.rate&&(e.idleCounter=0,t=e.callback.call(this,this),t&&o.unshift(i)));if(r=o.length){for(i=0;r>i;i+=1)a.splice(o[i],1);this.checkUpdate()}}}),t.PSprite=Object.create(t.PBaseSprite),t.extend(t.PSprite,{init:function(e,r,i){var a,n=r||{};this.options?a=this.options:(a={},this.options=a),t.extend(a,{animation:null,animationIndex:0,callback:null,idleCounter:0,lastSpriteSheet:0,currentSpriteSheet:0,numberOfFrame:0,currentFrame:0,frameIncrement:1,multix:0,multiy:0,paused:!1}),t.PBaseSprite.init.apply(this,arguments),void 0===n.animation&&(n.animation=null),this.setAnimation(n)},setAnimation:function(e){var r,i,a,n,o=this.options,s=e||{},h=void 0!==s.animation,l=void 0!==s.animationIndex;return h&&(r=t.r[s.animation],o.animation=r,o.callback=null,o.paused=!1,r?(a=Object.create(r.options),s.width=a.frameWidth,s.height=a.frameHeight):(window.console&&s.animation&&(console.error("Animation with name "+s.animation+" does not exist"),console.trace()),a=null,s.width=0,s.height=0),this.animation_options=a,t.PBaseSprite.resize.call(this,s),0===o.animationIndex||l||(s.animationIndex=0,l=!0)),a=this.animation_options,void 0!==s.rate&&(a.rate=Math.max(Math.round(s.rate/t.REFRESH_RATE),1)||1),void 0!==s.once&&(a.once=s.once,h=!0),void 0!==s.pingpong&&(a.pingpong=s.pingpong,h=!0),void 0!==s.backwards&&(a.backwards=s.backwards,h=!0),(h||l)&&(a&&a.backwards?(o.lastSpriteSheet=a.frameset.length-1,o.currentSpriteSheet=o.lastSpriteSheet,o.numberOfFrame=a.frameset[o.currentSpriteSheet].numberOfFrame,o.currentFrame=o.numberOfFrame-1,o.frameIncrement=-1):(o.currentSpriteSheet=0,a?(o.lastSpriteSheet=a.frameset.length-1,o.numberOfFrame=a.frameset[0].numberOfFrame):(o.lastSpriteSheet=0,o.numberOfFrame=0),o.currentFrame=0,o.frameIncrement=1),o.idleCounter=0,this.endAnimation=!1),l&&(i=s.animationIndex,o.animationIndex=i,r=o.animation,r&&i?(n=a.frameset[o.currentSpriteSheet],o.multix=i*n.multix,o.multiy=i*n.multiy):(o.multix=0,o.multiy=0)),void 0!==s.callback&&(o.callback=s.callback),void 0!==s.paused&&(o.paused=s.paused),this.checkUpdate(),this},resize:null,checkUpdate:function(){var e=this.options,t=this.needsUpdate;0===this.callbacks.length&&(this.endAnimation||e.paused||!e.callback&&(!e.animation||e.lastSpriteSheet<=0&&e.numberOfFrame<=1))?this.needsUpdate=!1:this.needsUpdate=!0,this.updateNeedsUpdate(t)},update:function(){var e=this.options,r=e.callback,i=e.animation,a=this.animation_options,n=e.currentSpriteSheet,o=e.currentFrame;this.endAnimation||e.paused||(i?(e.idleCounter+=1,e.idleCounter>=a.rate&&(e.idleCounter=0,o+=e.frameIncrement,a.backwards?a.pingpong?o>=e.numberOfFrame?n<e.lastSpriteSheet?(n+=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,e.currentFrame=0):(e.frameIncrement=-1,a.once?(o-=1,e.idleCounter=1,this.endAnimation=!0):e.numberOfFrame>1?o-=2:e.lastSpriteSheet>0?(n-=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,o=e.numberOfFrame-1):o-=1,e.currentFrame=o,r&&r.call(this,this)):0>o?n>0?(n-=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,e.currentFrame=e.numberOfFrame-1):(e.frameIncrement=1,e.numberOfFrame>1?o=1:e.lastSpriteSheet>0?(n+=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,o=0):o=0,e.currentFrame=o):e.currentFrame=o:0>o?n>0?(n-=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,e.currentFrame=e.numberOfFrame-1):(a.once?(o=0,e.idleCounter=1,this.endAnimation=!0):(n=e.lastSpriteSheet,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,o=e.numberOfFrame-1),e.currentFrame=o,r&&r.call(this,this)):e.currentFrame=o:a.pingpong?0>o?n>0?(n-=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,e.currentFrame=e.numberOfFrame-1):(e.frameIncrement=1,a.once?(o=0,e.idleCounter=1,this.endAnimation=!0):e.numberOfFrame>1?o=1:e.lastSpriteSheet>0?(n+=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,o=0):o=0,e.currentFrame=o,r&&r.call(this,this)):o>=e.numberOfFrame?n<e.lastSpriteSheet?(n+=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,e.currentFrame=0):(e.frameIncrement=-1,e.numberOfFrame>1?o-=2:e.lastSpriteSheet>0?(n-=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,o=e.numberOfFrame-1):o-=1,e.currentFrame=o):e.currentFrame=o:o>=e.numberOfFrame?n<e.lastSpriteSheet?(n+=1,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,e.currentFrame=0):(a.once?(o-=1,e.idleCounter=1,this.endAnimation=!0):(n=0,e.currentSpriteSheet=n,e.numberOfFrame=a.frameset[n].numberOfFrame,o=0),e.currentFrame=o,r&&r.call(this,this)):e.currentFrame=o)):r&&r.call(this,this)),t.PBaseSprite.update.call(this)}}),t.Sprite=t.Maker(t.PSprite),t.PSpriteGroup=Object.create(t.PBaseSprite),t.extend(t.PSpriteGroup,{init:function(e,r,i){var a,n=r||{};this.options?a=this.options:(a={},this.options=a),t.extend(a,{background:null,backgroundType:t.BACKGROUND_TILED,crop:!1,borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:1,borderColor:null,hasBorder:!1}),n.parentDOM&&(this.parentDOM=n.parentDOM),this.layers=[],t.PBaseSprite.init.apply(this,arguments),this.needsUpdate=!0,this.updateList=[],this.clearing=!1,void 0===n.background&&(n.background=null),this.setBackground(n),this.setBorder(n)},remove:function(){this.clear(),t.PBaseSprite.remove.apply(this,arguments)},resize:function(e){var r,i={},a=!1;return t.PBaseSprite.resize.call(this,e),this.parent&&(r=t.s[this.parent],this.width||(i.width=r.width,a=!0),this.height||(i.height=r.height,a=!0),a&&t.PBaseSprite.resize.call(this,i)),this},clear:function(){var e,t=this.layers,r=t.length;for(this.clearing=!0,e=0;r>e;e+=1)t[e].obj.remove();return this.clearing=!1,this.layers=[],this.updateList=[],this},children:function(e){var t,r,i,a,n=this.layers,o=n.length;if(e)for(a=0;o>a&&(t=n[a],!(t&&(r=t.obj,i=e.call(r,r))));a+=1);return this},setBackground:function(e){var r=this.options,i=e||{};return void 0!==i.background&&(r.background=t.r[i.background]||null,window.console&&i.background&&!r.background&&(console.error("Background with name "+i.background+" does not exist"),console.trace())),void 0!==i.backgroundType&&(r.backgroundType=i.backgroundType),this},setBorder:function(e){var r,i=this.options,a=e||{},n=a.borderRadius,o=Math.max,s=t.truncate;return void 0!==a.borderColor&&(i.borderColor=t.r[a.borderColor]||null,window.console&&a.borderColor&&!i.borderColor&&(console.error("Color with name "+a.borderColor+" does not exist"),console.trace())),void 0!==n&&("number"==typeof n?(n=o(s(n),0)||0,i.borderTopLeftRadius=n,i.borderTopRightRadius=n,i.borderBottomRightRadius=n,i.borderBottomLeftRadius=n):(r=n.length,r>=4?(i.borderTopLeftRadius=o(s(n[0]),0)||0,i.borderTopRightRadius=o(s(n[1]),0)||0,i.borderBottomRightRadius=o(s(n[2]),0)||0,i.borderBottomLeftRadius=o(s(n[3]),0)||0):3===r?(i.borderTopLeftRadius=o(s(n[0]),0)||0,i.borderTopRightRadius=o(s(n[1]),0)||0,i.borderBottomRightRadius=o(s(n[2]),0)||0,i.borderBottomLeftRadius=o(s(n[1]),0)||0):2===r?(i.borderTopLeftRadius=o(s(n[0]),0)||0,i.borderTopRightRadius=o(s(n[1]),0)||0,i.borderBottomRightRadius=o(s(n[0]),0)||0,i.borderBottomLeftRadius=o(s(n[1]),0)||0):(i.borderTopLeftRadius=o(s(n[0]),0)||0,i.borderTopRightRadius=o(s(n[0]),0)||0,i.borderBottomRightRadius=o(s(n[0]),0)||0,i.borderBottomLeftRadius=o(s(n[0]),0)||0))),void 0!==a.borderTopLeftRadius&&(i.borderTopLeftRadius=o(s(a.borderTopLeftRadius),0)||0),void 0!==a.borderTopRightRadius&&(i.borderTopRightRadius=o(s(a.borderTopRightRadius),0)||0),void 0!==a.borderBottomRightRadius&&(i.borderBottomRightRadius=o(s(a.borderBottomRightRadius),0)||0),void 0!==a.borderBottomLeftRadius&&(i.borderBottomLeftRadius=o(s(a.borderBottomLeftRadius),0)||0),void 0!==a.borderWidth&&(i.borderWidth=o(s(a.borderWidth),0)||0),i.borderColor&&i.borderWidth?i.hasBorder=!0:i.hasBorder=!1,this},crop:function(e){var t=this.options;return void 0===e?t.crop:(t.crop=e,this)},addSprite:function(e,r){var i=t.Sprite(e,r,this.name);return this.layers.push({name:e,obj:i}),this},insertSprite:function(e,r){var i=t.Sprite(e,r,this.name);return this.layers.unshift({name:e,obj:i}),this},addGroup:function(e,r){var i=t.SpriteGroup(e,r,this.name);return this.layers.push({name:e,obj:i}),this.updateList.push({name:e,obj:i}),i},insertGroup:function(e,r){var i=t.SpriteGroup(e,r,this.name);return this.layers.unshift({name:e,obj:i}),this.updateList.unshift({name:e,obj:i}),i},end:function(){var e=this.parent;return e||(e=this.name),t.s[e]},checkUpdate:t.noop,update:function(){var e,r=this.updateList,i=r.length;for(e=0;i>e;e+=1)r[e]&&r[e].obj.update();t.PBaseSprite.update.call(this)},draw:function(e){var r,i=Math.round,a=i(this.left*e+this.prevLeft*(1-e)),n=i(this.top*e+this.prevTop*(1-e)),o=this.layers,s=o.length;for(t.absLeft+=a,t.absTop+=n,r=0;s>r;r+=1)o[r].obj.draw(e);t.absLeft-=a,t.absTop-=n}}),t.SpriteGroup=t.Maker(t.PSpriteGroup),t.extend(t,{playground:function(r){var i,a=t.s.playground,n=t.playgroundCallbacks,o=n.length;if(!a){for("string"==typeof r?("#"===r[0]&&(r=r.split("#")[1]),r=document.getElementById(r)):r?r.jquery&&(r=r.get(0)):r=document.getElementById("playground"),a=t.SpriteGroup("playground",{width:r.offsetWidth,height:r.offsetHeight,parentDOM:r},""),a.resize=null,a.move=null,a.crop=null,i=0;o>i;i+=1)n[i].call(a,r);n.splice(0,o),t.running&&null===t.idDraw&&(t.accumulator=0,t.currentTime=performance.now(),t.idDraw=e(t.draw))}return a},startGame:function(e){var r=t.resourceManager;return t.running=!0,void 0!==e&&(window.console&&e&&r.completeCallback&&window.console&&(console.warn("Overriding the existing startGame callback"),console.trace()),r.completeCallback=e),r.preload(),null===r.idPreload&&(r.idPreload=setInterval(r.preload,100)),this},stopGame:function(){return t.running=!1,this},loadCallback:function(e){return t.resourceManager.loadCallback=e,this},startCallback:function(e){return t.resourceManager.startCallbacks.push(e),this},playgroundCallback:function(e){var r=t.s.playground;return r?setTimeout(function(){e.call(r,r.parentDOM)},0):t.playgroundCallbacks.push(e),this},forceRedraw:function(){return null===t.idDraw&&(t.idDraw=e(t.draw)),this},draw:function(r){var i=t.s.playground,a=t.REFRESH_RATE,n=0,o=t.accumulator,s=r,h=s-t.currentTime;if(t.running){if(t.idDraw=e(t.draw),t.currentTime=s,o+=h,o>=a)for(;o>=a;)if(i.update(),o-=a,t.frameCounter+=1,n+=1,n>=240){o=0;break}t.accumulator=o}else t.idDraw=null;i.draw(o/a)},insidePlayground:function(e,r,i,a){var n=t.s.playground,o=t.absLeft+e,s=t.absTop+r;return!(0>=s+a||s>=n.height||o>=n.width||0>=o+i)}})}();