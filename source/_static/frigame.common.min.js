!function(){"use strict";var e,t={};window.friGame=t,Date.now||(Date.now=function(){return(new Date).getTime()}),window.performance||(window.performance={}),window.performance.now||(window.performance.now=window.performance.mozNow||window.performance.msNow||window.performance.oNow||window.performance.webkitNow||Date.now),e=function(){var e,t=0,r=["ms","moz","webkit","o"],i=window.requestAnimationFrame;for(e=0;e<r.length&&!i;e+=1)i=window[r[e]+"RequestAnimationFrame"];return i||(i=function(e){var r=performance.now(),i=Math.max(0,16-(r-t)),n=window.setTimeout(function(){e(r+i)},i);return t=r+i,n}),i}(),"function"!=typeof Object.create&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),t.extend=function(e,t){var r,i;if(t)for(r in t)e!==(i=t[r])&&void 0!==i&&(e[r]=i);return e},t.extend(t,{GRADIENT_VERTICAL:0,GRADIENT_HORIZONTAL:1,ANIMATION_VERTICAL:0,ANIMATION_HORIZONTAL:1,BACKGROUND_TILED:0,BACKGROUND_STRETCHED:1,MASK_TILED:0,MASK_STRETCHED:1,REFRESH_RATE:1e3/60}),t.extend(t,{cssClass:"friGame",domPrefix:"friGame_",resources:{},sprites:{},playgroundCallbacks:[],running:!1,idDraw:null,currentTime:0,accumulator:0,absLeft:0,absTop:0,frameCounter:0}),t.r=t.resources,t.s=t.sprites,t.extend(t,{Maker:function(e){return function(){var t=Object.create(e);return t.init.apply(t,arguments),t}},noop:function(){},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},each:function(e,t){var r,i,n=e.length;if(n>=0)for(i=0;i<n&&(r=e[i],!1!==t.call(r,i,r));i+=1);else for(i in e)if(r=e[i],!1===t.call(r,i,r))break;return e},pick:function(e,t){var r,i,n=t.length,a={};for(i=0;i<n;i+=1)void 0!==e[r=t[i]]&&(a[r]=e[r]);return a},inArray:function(e,t,r){var i;if(t)for(i=t.length,(r=r||0)<0&&(r=Math.max(0,i+r));r<i;){if(t[r]===e)return r;r+=1}return-1},truncate:function(e){return e<0?Math.ceil(e):Math.floor(e)},clamp:function(e,t,r){return Math.min(Math.max(e,t),r)}}),t.resourceManager={idPreload:null,preloadList:[],loadCallback:null,startCallbacks:[],completeCallback:null,addResource:function(e,r){return window.console&&t.r[e]&&(console.error("Resource with name "+e+" already exists"),console.trace()),t.resourceManager.preloadList.push(r),t.r[e]=r,t.resourceManager},removeResource:function(e,r){var i,n=r||{},a=t.r[e],o=t.resourceManager,s=o.preloadList,h=s.length;if(a){for(a.remove&&a.remove(),i=0;i<h;i+=1)if(s[i]===a){s.splice(i,1);break}t.r[e]=null,delete t.r[e]}else window.console&&!n.suppressWarning&&(console.warn("Resource with name "+e+" already removed"),console.trace());return o},clear:function(){var e,r,i,n=t.resourceManager,a=n.removeResource,o=t.r,s=[];for(e in o)o.hasOwnProperty(e)&&s.push(e);for(r=s.length,i=0;i<r;i+=1)a(s[i]);return n},preload:function(){var r,i=t.resourceManager,n=i.preloadList,a=n.length,o=0,s=i.loadCallback,h=i.startCallbacks,l=h.length,c=i.completeCallback;for(r=0;r<a;r+=1)n[r].complete&&!n[r].complete()||(o+=1);if(s&&(0!==a?s.call(t,o/a):s.call(t,1)),o===a){for(s&&(i.loadCallback=null),null!==i.idPreload&&(clearInterval(i.idPreload),i.idPreload=null),r=0;r<a;r+=1)n[r].onLoad&&n[r].onLoad();for(n.splice(0,a),r=0;r<l;r+=1)h[r].call(t);h.splice(0,l),t.running&&null===t.idDraw&&t.s.playground&&(t.accumulator=0,t.currentTime=performance.now(),t.idDraw=e(t.draw)),c&&(i.completeCallback=null,c.call(t))}}},t.PGradient={init:function(e,r,i){var n,a=t.clamp,o=Math.round;this.startColor={r:0,g:0,b:0,a:1},(e=e?t.extend(this.startColor,t.pick(e,["r","g","b","a"])):this.startColor).r=a(o(e.r),0,255),e.g=a(o(e.g),0,255),e.b=a(o(e.b),0,255),e.a=a(e.a,0,1),n="rgba("+String(e.r)+","+String(e.g)+","+String(e.b)+","+String(e.a)+")",this.startColorStr=n,this.name=n,r?(this.endColor={r:0,g:0,b:0,a:1},(r=t.extend(this.endColor,t.pick(r,["r","g","b","a"]))).r=a(o(r.r),0,255),r.g=a(o(r.g),0,255),r.b=a(o(r.b),0,255),r.a=a(r.a,0,1),this.endColorStr="rgba("+String(r.r)+","+String(r.g)+","+String(r.b)+","+String(r.a)+")",n===this.endColorStr?this.endColor=e:this.name+=this.endColorStr):(this.endColor=e,this.endColorStr=n),this.type=void 0!==i?i:t.GRADIENT_VERTICAL},remove:function(){var e=this;t.each(t.s,function(){var t=this.options;t.background===e&&this.setBackground({background:null}),t.borderColor===e&&this.setBorder({borderColor:null})})}},t.Gradient=t.Maker(t.PGradient),t.resourceManager.addGradient=function(e){var r=Array.prototype.slice.call(arguments,1),i=t.Gradient.apply(this,r);return i.name=e,t.resourceManager.addResource(e,i)},t.PAnimation={images:{},init:function(e,r){var i,n,a,o,s,h,l;if(e&&"string"!=typeof e&&(r=e,e=null),n=r||{},this.options?i=this.options:(i={},this.options=i),t.extend(i,{rate:t.REFRESH_RATE,once:!1,pingpong:!1,backwards:!1,frameWidth:0,frameHeight:0,frameset:[],halfWidth:0,halfHeight:0}),t.extend(i,t.pick(n,["rate","once","pingpong","backwards","frameWidth","frameHeight"])),i.rate=Math.max(Math.round(n.rate/t.REFRESH_RATE),1)||1,o=i.frameset,e&&(a={imageURL:e,numberOfFrame:1,type:t.ANIMATION_HORIZONTAL,offsetx:0,offsety:0},t.extend(a,t.pick(n,["numberOfFrame","type","offsetx","offsety"])),a.img=this.getImage(e),o.push(a)),(s=n.frameset)&&(h=s.length))for(e||(e=s[0].imageURL),l=0;l<h;l+=1)a={imageURL:e,numberOfFrame:1,type:t.ANIMATION_HORIZONTAL,offsetx:0,offsety:0},t.extend(a,t.pick(s[l],["imageURL","numberOfFrame","type","offsetx","offsety"])),a.img=this.getImage(a.imageURL),o.push(a)},remove:function(){var e,r,i=t.PAnimation,n=this,a=this.options.frameset,o=a.length;for(t.each(t.s,function(){var e=this.options;e.animation===n&&this.setAnimation({animation:null}),e.background===n&&this.setBackground({background:null}),e.mask===n&&this.setMask({mask:null})}),r=0;r<o;r+=1)e=a[r].imageURL,i.images[e].refCount-=1,i.images[e].refCount<=0&&(i.images[e]=null,delete i.images[e])},complete:function(){var e,t,r=!0,i=this.options.frameset,n=i.length;for(t=0;t<n;t+=1)if(!((e=i[t].img).complete&&e.width&&e.height)){r=!1;break}return r},onLoad:function(){var e,r,i,n,a,o=this.options,s=t.truncate,h=o.frameset,l=h.length;for(l&&(e=(n=h[0]).img,n.type===t.ANIMATION_VERTICAL?(o.frameWidth||(o.frameWidth=e.width-n.offsetx),o.frameHeight||(o.frameHeight=s((e.height-n.offsety)/n.numberOfFrame))):(o.frameWidth||(o.frameWidth=s((e.width-n.offsetx)/n.numberOfFrame)),o.frameHeight||(o.frameHeight=e.height-n.offsety))),r=o.frameWidth,i=o.frameHeight,a=0;a<l;a+=1)(n=h[a]).type===t.ANIMATION_VERTICAL?(n.deltax=0,n.deltay=i,n.multix=r,n.multiy=0):(n.deltax=r,n.deltay=0,n.multix=0,n.multiy=i);o.halfWidth=s(r/2),o.halfHeight=s(i/2),this.width=r,this.height=i,this.halfWidth=o.halfWidth,this.halfHeight=o.halfHeight},getImage:function(e){var r,i=t.PAnimation;return i.images[e]?(r=i.images[e].img,i.images[e].refCount+=1):((r=new Image).src=e,i.images[e]={img:r,refCount:1}),r}},t.Animation=t.Maker(t.PAnimation),t.resourceManager.addAnimation=function(e){var r=Array.prototype.slice.call(arguments,1),i=t.Animation.apply(this,r);return i.name=e,t.resourceManager.addResource(e,i)},t.PRect={init:function(e){t.extend(this,{left:0,right:0,centerx:0,top:0,bottom:0,centery:0,width:0,height:0,halfWidth:0,halfHeight:0,radius:0,last_x:"left",last_y:"top"}),this.resize&&this.resize(e)},resize:function(e){var r,i=e||{},n=t.truncate,a=Math.max;return void 0!==i.width?(this.width=a(n(i.width),0)||0,this.halfWidth=a(n(i.width/2),0)||0,r=!0):void 0!==i.halfWidth?(this.width=a(n(2*i.halfWidth),0)||0,this.halfWidth=a(n(i.halfWidth),0)||0,r=!0):r=!1,void 0!==i.height?(this.height=a(n(i.height),0)||0,this.halfHeight=a(n(i.height/2),0)||0,r=!0):void 0!==i.halfHeight?(this.height=a(n(2*i.halfHeight),0)||0,this.halfHeight=a(n(i.halfHeight),0)||0,r=!0):r=!1,r?this.radius=a(this.halfWidth,this.halfHeight):void 0!==i.radius&&(this.radius=a(n(i.radius),0)||0,this.width=2*this.radius,this.height=this.width,this.halfWidth=this.radius,this.halfHeight=this.halfWidth),this.move&&this.move(e),this},move:function(e){var r,i,n=e||{},a=t.truncate;return void 0!==n.last_x&&void 0!==n[n.last_x]?(this[n.last_x]=a(n[n.last_x]),r=n.last_x):void 0!==n.centerx?(this.centerx=a(n.centerx),r="centerx"):void 0!==n.right?(this.right=a(n.right),r="right"):void 0!==n.left?(this.left=a(n.left),r="left"):r=this.last_x,void 0!==n.last_y&&void 0!==n[n.last_y]?(this[n.last_y]=a(n[n.last_y]),i=n.last_y):void 0!==n.centery?(this.centery=a(n.centery),i="centery"):void 0!==n.bottom?(this.bottom=a(n.bottom),i="bottom"):void 0!==n.top?(this.top=a(n.top),i="top"):i=this.last_y,"centerx"===r?(this.left=this.centerx-this.halfWidth,this.right=this.left+this.width):"right"===r?(this.left=this.right-this.width,this.centerx=this.left+this.halfWidth):(this.centerx=this.left+this.halfWidth,this.right=this.left+this.width),"centery"===i?(this.top=this.centery-this.halfHeight,this.bottom=this.top+this.height):"bottom"===i?(this.top=this.bottom-this.height,this.centery=this.top+this.halfHeight):(this.centery=this.top+this.halfHeight,this.bottom=this.top+this.height),this.last_x=r,this.last_y=i,this},collideRect:function(e){return!(this.bottom<=e.top||this.top>=e.bottom||this.left>=e.right||this.right<=e.left)},collideRectPoint:function(e,t){return e>=this.left&&e<this.right&&t>=this.top&&t<this.bottom},collideRectCircle:function(e){var r=t.clamp,i=e.centerx,n=e.centery,a=e.radius,o=i-r(i,this.left,this.right),s=n-r(n,this.top,this.bottom);return o*o+s*s<a*a},collideCircle:function(e){var t=e.centerx-this.centerx,r=e.centery-this.centery,i=this.radius+e.radius;return t*t+r*r<i*i},collideCirclePoint:function(e,t){var r=e-this.centerx,i=t-this.centery,n=this.radius;return r*r+i*i<n*n},collideCircleRect:function(e){var r=t.clamp,i=this.centerx,n=this.centery,a=this.radius,o=i-r(i,e.left,e.right),s=n-r(n,e.top,e.bottom);return o*o+s*s<a*a}},t.PRect.collidePointRect=t.PRect.collideRectPoint,t.PRect.collidePointCircle=t.PRect.collideCirclePoint,t.Rect=t.Maker(t.PRect),t.PBaseSprite=Object.create(t.PRect),t.extend(t.PBaseSprite,{init:function(e,r,i){var n;this.options?n=this.options:(n={},this.options=n),t.extend(n,{transformOriginx:"halfWidth",transformOriginy:"halfHeight",angle:0,scalex:1,scaley:1,fliph:1,flipv:1,alpha:1,hidden:!1,scaleh:1,scalev:1,blendMode:null,posOffsetX:0,posOffsetY:0}),window.console&&t.s[e]&&(console.error("Sprite with name "+e+" already exists"),console.trace()),t.s[e]=this,this.name=e,this.parent=i,this.userData=null,this.callbacks=[],this.needsUpdate=!1,this.frameCounterLastMove=t.frameCounter,this.prevLeft=0,this.prevTop=0,t.PRect.init.call(this,r),this.prevLeft=this.left,this.prevTop=this.top},remove:function(){var e,r,i,n,a,o,s=this.parent,h=this.name,l=this.userData;if(this.userData=null,l&&l.remove&&l.remove(),s&&!(e=t.s[s]).clearing){for(i=(r=e.layers).length,o=0;o<i;o+=1)if(r[o].name===h){r.splice(o,1);break}for(this.needsUpdate=!1,a=(n=e.updateList).length,o=0;o<a;o+=1)if(n[o].name===h){n.splice(o,1);break}e.checkUpdate()}t.s[h]?(t.s[h]=null,delete t.s[h]):window.console&&(console.warn("Sprite with name "+h+" already removed"),console.trace())},registerCallback:function(e,r){return r=Math.max(Math.round(r/t.REFRESH_RATE),1)||1,this.callbacks.push({callback:e,rate:r,idleCounter:0,remove:!1}),this.checkUpdate(),this},removeCallback:function(e,t){var r,i,n=t||{},a=!1,o=this.callbacks,s=o.length;for(i=0;i<s;i+=1)(r=o[i]).callback===e&&(a=!0,r.remove=!0);return!window.console||a||n.suppressWarning||(console.warn("No callbacks removed"),console.trace()),this},clearCallbacks:function(){var e,t=this.callbacks,r=t.length;for(e=0;e<r;e+=1)t[e].remove=!0;return this},hide:function(){return this.options.hidden=!0,this},show:function(){return this.options.hidden=!1,this},toggle:function(e){return void 0===e&&(e=this.options.hidden),this.options.hidden=!e,this},drawFirst:function(){var e,r,i,n,a=this.parent,o=this.name;if(a){for(r=(e=t.s[a].layers).length,n=0;n<r;n+=1)if(e[n].name===o){i=e.splice(n,1)[0];break}i&&e.unshift(i)}return this},drawLast:function(){var e,r,i,n,a=this.parent,o=this.name;if(a){for(r=(e=t.s[a].layers).length,n=0;n<r;n+=1)if(e[n].name===o){i=e.splice(n,1)[0];break}i&&e.push(i)}return this},getDrawIndex:function(){var e,r,i,n=this.parent,a=this.name;if(n)for(r=(e=t.s[n].layers).length,i=0;i<r;i+=1)if(e[i].name===a)return i;return 0},drawTo:function(e){var r,i,n,a,o=this.parent,s=this.name;if(o){for(i=(r=t.s[o].layers).length,a=0;a<i;a+=1)if(r[a].name===s){n=r.splice(a,1)[0];break}n&&r.splice(t.clamp(Math.round(e),0,r.length),0,n)}return this},drawBefore:function(e){var r,i,n,a,o=!1,s=this.parent,h=this.name;if(s){for(i=(r=t.s[s].layers).length,a=0;a<i;a+=1)if(r[a].name===h){n=r.splice(a,1)[0],i-=1;break}for(a=0;a<i;a+=1)if(r[a].name===e){o=!0;break}n&&r.splice(a,0,n)}return window.console&&!o&&(console.error("Sprite with name "+e+" not found in the same sprite group"),console.trace()),this},drawAfter:function(e){var r,i,n,a,o=!1,s=this.parent,h=this.name;if(s){for(i=(r=t.s[s].layers).length,a=0;a<i;a+=1)if(r[a].name===h){n=r.splice(a,1)[0],i-=1;break}for(a=0;a<i;a+=1)if(r[a].name===e){o=!0,a+=1;break}n&&r.splice(a,0,n)}return window.console&&!o&&(console.error("Sprite with name "+e+" not found in the same sprite group"),console.trace()),this},transformOrigin:function(e,r){var i=this.options,n=t.truncate;return void 0===e?i.transformOriginx:("string"==typeof e?window.console&&"halfWidth"!==e&&"width"!==e&&(console.error("Invalid originx: "+e),console.trace()):e=n(e)||0,i.transformOriginx=e,void 0===r?i.transformOriginy="halfWidth"===e?"halfHeight":"width"===e?"height":e:"string"==typeof r?(i.transformOriginy=r,window.console&&"halfHeight"!==r&&"height"!==r&&(console.error("Invalid originy: "+r),console.trace())):i.transformOriginy=n(r)||0,this)},transformOriginx:function(e){var r=this.options;return void 0===e?r.transformOriginx:("string"==typeof e?(r.transformOriginx=e,window.console&&"halfWidth"!==e&&"width"!==e&&(console.error("Invalid originx: "+e),console.trace())):r.transformOriginx=t.truncate(e)||0,this)},transformOriginy:function(e){var r=this.options;return void 0===e?r.transformOriginy:("string"==typeof e?(r.transformOriginy=e,window.console&&"halfHeight"!==e&&"height"!==e&&(console.error("Invalid originy: "+e),console.trace())):r.transformOriginy=t.truncate(e)||0,this)},rotate:function(e){return void 0===e?this.options.angle:(this.options.angle=e,this)},scale:function(e,t){var r=this.options;return void 0===e?r.scalex:(r.scalex=e,r.scaleh=e*r.fliph,void 0===t?(r.scaley=e,r.scalev=e*r.flipv):(r.scaley=t,r.scalev=t*r.flipv),this)},scalex:function(e){var t=this.options;return void 0===e?t.scalex:(t.scalex=e,t.scaleh=e*t.fliph,this)},scaley:function(e){var t=this.options;return void 0===e?t.scaley:(t.scaley=e,t.scalev=e*t.flipv,this)},fliph:function(e){var t=this.options;return void 0===e?t.fliph<0:(e?(t.fliph=-1,t.scaleh=-t.scalex):(t.fliph=1,t.scaleh=t.scalex),this)},flipv:function(e){var t=this.options;return void 0===e?t.flipv<0:(e?(t.flipv=-1,t.scalev=-t.scaley):(t.flipv=1,t.scalev=t.scaley),this)},opacity:function(e){return void 0===e?this.options.alpha:(this.options.alpha=t.clamp(e,0,1),this)},blendMode:function(e){return void 0===e?this.options.blendMode:(this.options.blendMode=e,this)},getAbsRect:function(){for(var e=this.left,r=this.top,i=t.s[this.parent];i;)e+=i.left,r+=i.top,i=t.s[i.parent];return t.Rect({left:e,top:r,width:this.width,height:this.height})},move:function(e){var r=t.frameCounter;r!==this.frameCounterLastMove&&(this.prevLeft=this.left,this.prevTop=this.top,this.frameCounterLastMove=r),t.PRect.move.apply(this,arguments)},checkUpdate:function(){var e=this.needsUpdate;0===this.callbacks.length?this.needsUpdate=!1:this.needsUpdate=!0,this.updateNeedsUpdate(e)},updateNeedsUpdate:function(e){var r,i,n,a=this.parent,o=this.name;if(a)if(this.needsUpdate&&!e)t.s[a].updateList.push({name:o,obj:this});else if(!this.needsUpdate&&e)for(i=(r=t.s[a].updateList).length,n=0;n<i;n+=1)if(r[n].name===o){r.splice(n,1);break}},update:function(){var e,t,r,i=this.callbacks,n=i.length,a=[];for(r=0;r<n;r+=1)(e=i[r]).remove?a.unshift(r):(e.idleCounter+=1,e.idleCounter>=e.rate&&(e.idleCounter=0,e.callback.call(this,this)&&a.unshift(r)));if(t=a.length){for(r=0;r<t;r+=1)i.splice(a[r],1);this.checkUpdate()}}}),t.PSprite=Object.create(t.PBaseSprite),t.extend(t.PSprite,{init:function(e,r,i){var n,a=r||{};this.options?n=this.options:(n={},this.options=n),t.extend(n,{animation:null,animationIndex:0,callback:null,idleCounter:0,lastSpriteSheet:0,currentSpriteSheet:0,numberOfFrame:0,currentFrame:0,frameIncrement:1,multix:0,multiy:0,paused:!1}),t.PBaseSprite.init.apply(this,arguments),void 0===a.animation&&(a.animation=null),this.setAnimation(a),this.prevLeft=this.left,this.prevTop=this.top},setAnimation:function(e){var r,i,n,a,o=this.options,s=e||{},h=void 0!==s.animation,l=void 0!==s.animationIndex;return h&&(r=t.r[s.animation],o.animation=r,o.callback=null,o.paused=!1,r?(n=Object.create(r.options),s.width=n.frameWidth,s.height=n.frameHeight):(window.console&&s.animation&&(console.error("Animation with name "+s.animation+" does not exist"),console.trace()),n=null,s.width=0,s.height=0),this.animation_options=n,t.PBaseSprite.resize.call(this,s),0===o.animationIndex||l||(s.animationIndex=0,l=!0)),n=this.animation_options,void 0!==s.rate&&(n.rate=Math.max(Math.round(s.rate/t.REFRESH_RATE),1)||1),void 0!==s.once&&(n.once=s.once,h=!0),void 0!==s.pingpong&&(n.pingpong=s.pingpong,h=!0),void 0!==s.backwards&&(n.backwards=s.backwards,h=!0),(h||l)&&(n&&n.backwards?(o.lastSpriteSheet=n.frameset.length-1,o.currentSpriteSheet=o.lastSpriteSheet,o.numberOfFrame=n.frameset[o.currentSpriteSheet].numberOfFrame,o.currentFrame=o.numberOfFrame-1,o.frameIncrement=-1):(o.currentSpriteSheet=0,n?(o.lastSpriteSheet=n.frameset.length-1,o.numberOfFrame=n.frameset[0].numberOfFrame):(o.lastSpriteSheet=0,o.numberOfFrame=0),o.currentFrame=0,o.frameIncrement=1),o.idleCounter=0,this.endAnimation=!1),l&&(i=s.animationIndex,o.animationIndex=i,(r=o.animation)&&i?(a=n.frameset[o.currentSpriteSheet],o.multix=i*a.multix,o.multiy=i*a.multiy):(o.multix=0,o.multiy=0)),void 0!==s.callback&&(o.callback=s.callback),void 0!==s.paused&&(o.paused=s.paused),this.checkUpdate(),this},resize:null,checkUpdate:function(){var e=this.options,t=this.needsUpdate;0===this.callbacks.length&&(this.endAnimation||e.paused||!e.callback&&(!e.animation||e.lastSpriteSheet<=0&&e.numberOfFrame<=1))?this.needsUpdate=!1:this.needsUpdate=!0,this.updateNeedsUpdate(t)},update:function(){var e=this.options,r=e.callback,i=e.animation,n=this.animation_options,a=e.currentSpriteSheet,o=e.currentFrame;this.endAnimation||e.paused||(i?(e.idleCounter+=1,e.idleCounter>=n.rate&&(e.idleCounter=0,o+=e.frameIncrement,n.backwards?n.pingpong?o>=e.numberOfFrame?a<e.lastSpriteSheet?(a+=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,e.currentFrame=0):(e.frameIncrement=-1,n.once?(o-=1,e.idleCounter=1,this.endAnimation=!0):e.numberOfFrame>1?o-=2:e.lastSpriteSheet>0?(a-=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,o=e.numberOfFrame-1):o-=1,e.currentFrame=o,r&&r.call(this,this)):o<0?a>0?(a-=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,e.currentFrame=e.numberOfFrame-1):(e.frameIncrement=1,e.numberOfFrame>1?o=1:e.lastSpriteSheet>0?(a+=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,o=0):o=0,e.currentFrame=o):e.currentFrame=o:o<0?a>0?(a-=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,e.currentFrame=e.numberOfFrame-1):(n.once?(o=0,e.idleCounter=1,this.endAnimation=!0):(a=e.lastSpriteSheet,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,o=e.numberOfFrame-1),e.currentFrame=o,r&&r.call(this,this)):e.currentFrame=o:n.pingpong?o<0?a>0?(a-=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,e.currentFrame=e.numberOfFrame-1):(e.frameIncrement=1,n.once?(o=0,e.idleCounter=1,this.endAnimation=!0):e.numberOfFrame>1?o=1:e.lastSpriteSheet>0?(a+=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,o=0):o=0,e.currentFrame=o,r&&r.call(this,this)):o>=e.numberOfFrame?a<e.lastSpriteSheet?(a+=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,e.currentFrame=0):(e.frameIncrement=-1,e.numberOfFrame>1?o-=2:e.lastSpriteSheet>0?(a-=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,o=e.numberOfFrame-1):o-=1,e.currentFrame=o):e.currentFrame=o:o>=e.numberOfFrame?a<e.lastSpriteSheet?(a+=1,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,e.currentFrame=0):(n.once?(o-=1,e.idleCounter=1,this.endAnimation=!0):(a=0,e.currentSpriteSheet=a,e.numberOfFrame=n.frameset[a].numberOfFrame,o=0),e.currentFrame=o,r&&r.call(this,this)):e.currentFrame=o)):r&&r.call(this,this)),t.PBaseSprite.update.call(this)}}),t.Sprite=t.Maker(t.PSprite),t.PSpriteGroup=Object.create(t.PBaseSprite),t.extend(t.PSpriteGroup,{init:function(e,r,i){var n,a=r||{};this.options?n=this.options:(n={},this.options=n),t.extend(n,{background:null,backgroundType:t.BACKGROUND_TILED,mask:null,maskType:t.MASK_TILED,crop:!1,borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:1,borderColor:null,hasBorder:!1}),a.parentDOM&&(this.parentDOM=a.parentDOM),this.layers=[],t.PBaseSprite.init.apply(this,arguments),this.updateList=[],this.clearing=!1,void 0===a.background&&(a.background=null),void 0===a.mask&&(a.mask=null),this.setBackground(a),this.setMask(a),this.setBorder(a)},remove:function(){this.clear(),t.PBaseSprite.remove.apply(this,arguments)},resize:function(e){var r,i={},n=!1;return t.PBaseSprite.resize.call(this,e),this.parent&&(r=t.s[this.parent],this.width||(i.width=r.width,n=!0),this.height||(i.height=r.height,n=!0),n&&t.PBaseSprite.resize.call(this,i)),this},clear:function(){var e,t=this.layers,r=t.length;for(this.clearing=!0,e=0;e<r;e+=1)t[e].obj.remove();return this.clearing=!1,this.layers.splice(0,r),this.updateList.splice(0,this.updateList.length),this.checkUpdate(),this},children:function(e){var t,r,i,n=this.layers,a=n.length;if(e)for(i=0;i<a&&!((t=n[i])&&(r=t.obj,e.call(r,r)));i+=1);return this},setBackground:function(e){var r=this.options,i=e||{},n=i.background;return void 0!==n&&(r.background=n?"string"==typeof n?t.r[n]||null:n:null,window.console&&n&&!r.background&&(console.error("Background with name "+n+" does not exist"),console.trace())),void 0!==i.backgroundType&&(r.backgroundType=i.backgroundType),this},setMask:function(e){var r=this.options,i=e||{};return void 0!==i.mask&&(r.mask=t.r[i.mask]||null,window.console&&i.mask&&!r.mask&&(console.error("Mask with name "+i.mask+" does not exist"),console.trace())),void 0!==i.maskType&&(r.maskType=i.maskType),this},setBorder:function(e){var r,i=this.options,n=e||{},a=n.borderColor,o=n.borderRadius,s=Math.max,h=t.truncate;return void 0!==a&&(i.borderColor=a?"string"==typeof a?t.r[a]||null:a:null,window.console&&a&&!i.borderColor&&(console.error("Color with name "+a+" does not exist"),console.trace())),void 0!==o&&("number"==typeof o?(o=s(h(o),0)||0,i.borderTopLeftRadius=o,i.borderTopRightRadius=o,i.borderBottomRightRadius=o,i.borderBottomLeftRadius=o):(r=o.length)>=4?(i.borderTopLeftRadius=s(h(o[0]),0)||0,i.borderTopRightRadius=s(h(o[1]),0)||0,i.borderBottomRightRadius=s(h(o[2]),0)||0,i.borderBottomLeftRadius=s(h(o[3]),0)||0):3===r?(i.borderTopLeftRadius=s(h(o[0]),0)||0,i.borderTopRightRadius=s(h(o[1]),0)||0,i.borderBottomRightRadius=s(h(o[2]),0)||0,i.borderBottomLeftRadius=s(h(o[1]),0)||0):2===r?(i.borderTopLeftRadius=s(h(o[0]),0)||0,i.borderTopRightRadius=s(h(o[1]),0)||0,i.borderBottomRightRadius=s(h(o[0]),0)||0,i.borderBottomLeftRadius=s(h(o[1]),0)||0):(i.borderTopLeftRadius=s(h(o[0]),0)||0,i.borderTopRightRadius=s(h(o[0]),0)||0,i.borderBottomRightRadius=s(h(o[0]),0)||0,i.borderBottomLeftRadius=s(h(o[0]),0)||0)),void 0!==n.borderTopLeftRadius&&(i.borderTopLeftRadius=s(h(n.borderTopLeftRadius),0)||0),void 0!==n.borderTopRightRadius&&(i.borderTopRightRadius=s(h(n.borderTopRightRadius),0)||0),void 0!==n.borderBottomRightRadius&&(i.borderBottomRightRadius=s(h(n.borderBottomRightRadius),0)||0),void 0!==n.borderBottomLeftRadius&&(i.borderBottomLeftRadius=s(h(n.borderBottomLeftRadius),0)||0),void 0!==n.borderWidth&&(i.borderWidth=s(h(n.borderWidth),0)||0),i.borderColor&&i.borderWidth?i.hasBorder=!0:i.hasBorder=!1,this},crop:function(e){var t=this.options;return void 0===e?t.crop:(t.crop=e,this)},addSprite:function(e,r){var i=t.Sprite(e,r,this.name);return this.layers.push({name:e,obj:i}),this.checkUpdate(),this},insertSprite:function(e,r){var i=t.Sprite(e,r,this.name);return this.layers.unshift({name:e,obj:i}),this.checkUpdate(),this},addGroup:function(e,r){var i=t.SpriteGroup(e,r,this.name);return this.layers.push({name:e,obj:i}),this.checkUpdate(),i},insertGroup:function(e,r){var i=t.SpriteGroup(e,r,this.name);return this.layers.unshift({name:e,obj:i}),this.checkUpdate(),i},end:function(){var e=this.parent;return e||(e=this.name),t.s[e]},checkUpdate:function(){var e=this.needsUpdate;0===this.callbacks.length&&0===this.layers.length?this.needsUpdate=!1:this.needsUpdate=!0,this.updateNeedsUpdate(e)},update:function(){var e,r=this.updateList,i=r.length;for(e=0;e<i;e+=1)r[e]&&r[e].obj.update();t.PBaseSprite.update.call(this)},draw:function(e){var r,i=Math.round,n=i(this.left*e+this.prevLeft*(1-e)),a=i(this.top*e+this.prevTop*(1-e)),o=this.layers,s=o.length;for(t.absLeft+=n,t.absTop+=a,r=0;r<s;r+=1)o[r].obj.draw(e);t.absLeft-=n,t.absTop-=a}}),t.SpriteGroup=t.Maker(t.PSpriteGroup),t.extend(t,{playground:function(r){var i,n=t.s.playground,a=t.playgroundCallbacks,o=a.length;if(!n){for("string"==typeof r?("#"===r[0]&&(r=r.split("#")[1]),r=document.getElementById(r)):r?r.jquery&&(r=r.get(0)):r=document.getElementById("playground"),(n=t.SpriteGroup("playground",{width:r.offsetWidth,height:r.offsetHeight,parentDOM:r},"")).resize=null,n.move=null,n.crop=null,i=0;i<o;i+=1)a[i].call(n,r);a.splice(0,o),t.running&&null===t.idDraw&&(t.accumulator=0,t.currentTime=performance.now(),t.idDraw=e(t.draw))}return n},startGame:function(e){var r=t.resourceManager;return t.running=!0,void 0!==e&&(window.console&&e&&r.completeCallback&&window.console&&(console.warn("Overriding the existing startGame callback"),console.trace()),r.completeCallback=e),r.preload(),null===r.idPreload&&(r.idPreload=setInterval(r.preload,100)),this},stopGame:function(){return t.running=!1,this},loadCallback:function(e){return t.resourceManager.loadCallback=e,this},startCallback:function(e){return t.resourceManager.startCallbacks.push(e),this},playgroundCallback:function(e){var r=t.s.playground;return r?setTimeout(function(){e.call(r,r.parentDOM)},0):t.playgroundCallbacks.push(e),this},forceRedraw:function(){return null===t.idDraw&&(t.idDraw=e(t.draw)),this},draw:function(r){var i=t.s.playground,n=t.REFRESH_RATE,a=0,o=t.accumulator,s=r,h=s-t.currentTime;if(t.running){if(t.idDraw=e(t.draw),t.currentTime=s,(o+=h)>=n)for(;o>=n;)if(i.update(),o-=n,t.frameCounter+=1,(a+=1)>=240){o=0;break}t.accumulator=o}else t.idDraw=null;i.draw(o/n)},insidePlayground:function(e,r,i,n){var a=t.s.playground,o=t.absLeft+e,s=t.absTop+r;return!(s+n<=0||s>=a.height||o>=a.width||o+i<=0)}})}();